<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">

<!-- Mirrored from wiki.qt.io/index.php?title=ValueBasedAndPointerBasedTypes&action=edit by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 05 Nov 2015 13:00:53 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8" />
<title>View source for ValueBasedAndPointerBasedTypes - Qt Wiki</title>
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />
<meta name="generator" content="MediaWiki 1.23.3" />
<meta name="robots" content="noindex,nofollow" />
<link rel="shortcut icon" href="http://wiki.qt.io/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="http://wiki.qt.io/opensearch_desc.php" title="Qt Wiki (en)" />
<link rel="EditURI" type="application/rsd+xml" href="http://wiki.qt.io/api.php?action=rsd" />
<link rel="alternate" type="application/atom+xml" title="Qt Wiki Atom feed" href="http://wiki.qt.io/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="http://wiki.qt.io/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.skinning.interface%7Cmediawiki.ui.button%7Cskins.vector.styles&amp;only=styles&amp;skin=vector&amp;*" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="http://wiki.qt.io/load.php?debug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=vector&amp;*" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: qtio_wiki:resourceloader:filter:minify-css:7:e91d7bc946738c8892a88ad5616a59ba */</style>
<script src="http://wiki.qt.io/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"ValueBasedAndPointerBasedTypes","wgTitle":"ValueBasedAndPointerBasedTypes","wgCurRevisionId":16132,"wgRevisionId":0,"wgArticleId":2117,"wgIsArticle":false,"wgIsRedirect":false,"wgAction":"edit","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":true,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"ValueBasedAndPointerBasedTypes","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"dialogs":true,"hidesig":true,"preview":true,"previewDialog":false,"publish":true}});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"editfont":"default","editondblclick":0,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":1,"extendwatchlist":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"imagesize":2,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nickname":"","norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"rcdays":7,"rclimit":50,"rows":25,"showhiddencats":0,"shownumberswatching":1,"showtoolbar":1,"skin":"vector","stubthreshold":0,"thumbsize":2,"underline":2,"uselivepreview":0,"usenewrc":0,"watchcreations":1,"watchdefault":1,"watchdeletion":0,"watchlistdays":3,"watchlisthideanons":0,"watchlisthidebots":0,"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"wllimit":250,
"useeditwarning":1,"prefershttps":1,"usebetatoolbar":1,"usebetatoolbar-cgd":1,"wikieditor-preview":1,"wikieditor-publish":1,"language":"en","variant-gan":"gan","variant-iu":"iu","variant-kk":"kk","variant-ku":"ku","variant-shi":"shi","variant-sr":"sr","variant-tg":"tg","variant-uz":"uz","variant-zh":"zh","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false,"searchNs500":false,"searchNs501":false,"searchNs700":false,"searchNs701":false,"variant":"en"});},{},{});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":false,"watchToken":false});},{},{});
/* cache key: qtio_wiki:resourceloader:filter:minify-js:7:9743cb8b8019d46de5946bfe6dfa04d7 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/vector/csshover.min.htc")}</style><![endif]--></head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-ValueBasedAndPointerBasedTypes skin-vector action-edit vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>
			<div id="mw-js-message" style="display:none;"></div>
						<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">View source for ValueBasedAndPointerBasedTypes</span></h1>
						<div id="bodyContent">
								<div id="contentSub">← <a href="http://wiki.qt.io/ValueBasedAndPointerBasedTypes" title="ValueBasedAndPointerBasedTypes">ValueBasedAndPointerBasedTypes</a></div>
												<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="#mw-navigation">navigation</a>, 					<a href="#p-search">search</a>
				</div>
				<div id="mw-content-text"><p>You do not have permission to edit this page, for the following reason:
</p>
<div class="permissions-errors">
<p>The action you have requested is limited to users in one of the groups: <a href="http://wiki.qt.io/index.php?title=Qt_Wiki:Users&amp;action=edit&amp;redlink=1" class="new" title="Qt Wiki:Users (page does not exist)">Users</a>, KnowledgeBase, QtWS.
</p>
</div>
<hr />
<p>You can view and copy the source of this page:
</p><textarea readonly="" accesskey="," id="wpTextbox1" cols="80" rows="25" style="" lang="en" dir="ltr" name="wpTextbox1">{{Cleanup | reason=Auto-imported from ExpressionEngine.}}

'''English''' [[ValueBasedAndPointerBasedTypes SimplifiedChinese|简体中文]]
[[Category:QtInternals]]


Written By : Girish Ramakrishnan, ForwardBias Technologies

= Overview =

Types in Qt can be broadly classified into two categories - value based types and pointer based types.

= Value based types =

In Qt, value based are those that you can treat akin to the C++ integral types like int, short, long. The copying and modification semantics for value based types has no ambiguity. For example,
&lt;code>
int x = 3;
int y = x;
x = 10;
&lt;/code>

In the above code, there is no ambiguity on what the value of y is. There is also no ambiguity that ''the value of y is unaffected after a change to x'' i.e y still has value 3 after x has been set to 10.

Value based types have the following characteristics:
* They have a copy constructor that creates a copy of the other variable
* An assignment operator that assigns itself a copy of other variable
* Changes to one variable never affects the value of another variable
* Have a '==' operator that helps you compare the values
* They are usually allocated on the stack

In Qt, QString, QList, QVector are all value based types. You can assign one to the other and expect the value to be copied. For example,
&lt;code>
QString s1 = "tahera";
QString s2 = s1;
s1 = "athena";
&lt;/code>

In the above code, the assignment on line 2 creates a copy of content of s1 into s2. s1 and s2 can change independently. In the third line when we change the value of s1, s2 is unchanged.

It appears expensive to copy the contents of s1 into s2, especially so for types like lists and vectors. Qt uses a technique called [http://doc.trolltech.com/shared.html implicit sharing] which makes such operations very efficient.

= Pointer based types =

Pointer based types are akin to objects of the real world. These types cannot be copied because it's hard/impossible to define intuitive semantics for copying these types. For example,

&lt;code>
class Human {
 …
 QString name;
 QString fatherName;
};
Human h1;
Human h2 = h1;
&lt;/code>

How is Human supposed to be copied? Is the human's name copied too? How about his body features? You end up in a situation where we have two humans objects that are one and the same, which as we know never happens in the real world. In these cases, it probably makes more sense to have an explicit function human2.copyBodyFeatures(human1) and disable the = operator.

A more Qt'ish example is a Button class. What happens when you do 'button2 = button1;'? Do you copy all attributes of button2 to button1? Widgets are usually part of a widget hierarchy. Does button2 have the same parent as button1 and has the same position/geometry as button1?

One tends to think of types like Button, Human as 'objects' or instances of a certain type. Such types are called pointer based types. They have the following characteristics:
* They don't have a copy constructor.
* They don't have an assignment operator.
* They don't have a  operator. It doesn't make sense to compare two objects (using operator ), you can only compare properties of objects.
* They derive from QObject
* They are usually allocated on the heap. This is not necessary, however, if you want to take advantage of QObject's memory management you have to allocate such types on the heap (see below).

Since such types cannot be copied or assigned, you would usually pass a pointer to these objects around.

= Memory management of QObject =

A feature of Qt is have a parent-child relationship between QObjects. Every QObject object has a parent QObject. When the parent QObject gets deleted or destroyed, it deletes it's children. This feature of Qt makes memory management of QObject's very simple. Just ensure that you delete all the top level QObjects and your code will not have any memory leaks. Deleting a top level window object will automatically delete all the child widgets. The deletion is performed by using the 'delete' operator. If any child QObject was created on the stack, your code will crash.

= Explicitly shared data types =

Since QObject has a built-in concept of memory management, it is usually obvious as to who owns the object when a function returns a pointer. For example, it is a fair guess that 'QStatusBar *QMainWindow::statusBar() const' returns a QStatusBar that is ''owned by the QMainWindow''. The user is not expected to delete the QStatusBar.

However, ownership information is not so clear if the returned types is ''not'' a QObject. As an example consider,
&lt;code>
QWebElement *element = webPage->getElementByName("company_info");
&lt;/code>

Is the QWebElement pointer returned owned by the webPage or by the user? What we would like is a data type that looks like a value based type from a memory management perspective i.e users don't think of deleting them) but behaves like a pointer based type i.e users continue to think of them as real world objects . Such 'pseudo' value based types are called ''explicitly shared data types''. For example, the above API could have been designed as,
&lt;code>
QWebElement e1 = webPage->getElementByName("company_info"); // e1 appears as a value based type
QWebElement e2 = e1; // can be copied. e1 and e2 are one and the same.
e2.setAttribute(attrib, value); // any change in e2 reflects in e1 (unlike implicitly shared data types)
&lt;/code>

The user does not think about deleting e1 or e2. At the same time, it is clear that just because the stack variables e1 and e2 die, the actual elements don't go away from the web page. The author likes to think of such types as glorified pointers - QWebElement is actually an interface to an internal structure of web page.

= Passing semantics for types =

In C+'', types can be passed around using 3 semantics - by value (copy), by pointer and by reference. Qt's approach to passing around variables is thus:
* Value based types are either passed by value or as a const-ref. For integral types like int, double passing by value (copy) is used. For Qt's value based types like QString, QList, passing a const-ref provides a minor optimization (we don't need to create a copy, even though the copying is extremely efficient because of implicit sharing).
* Object based types are always passed by pointer. For example, QWidget, QObject are always passed as pointers.
* For, readability, values are passed by pointer (as opposed to by reference) when the value itself is changed by a function. For example, writeToString(&amp;aString) is preferred over writeToString(aString /* passed by ref */);. The former makes it obvious (since it's the convention), that anything passed as pointer is expected to be modified.
''' Don't return a const-ref for value based types
&lt;code>
 class Widget {
 …
 const QColor &amp;color() const { return m_color; } // BAD STYLE!
 …
 private: QColor m_color;
 };
&lt;/code>
Reason: While it is true that there is a small performance boost to be gained by returning a const-ref, there is a problem with the above approach. Consider,
&lt;code>
 const QColor &amp;color = widget->color();
 delete widget;
 // color is now dangling!
&lt;/code>

Note that if color() had returned by value, it is correct C''+ to hold a const-ref to a temporary variable (i.e the copy returned by the function).
</textarea><div class="templatesUsed"><div class="mw-templatesUsedExplanation"><p>Templates used on this page:
</p></div><ul>
<li><a href="http://wiki.qt.io/Template:Ambox" title="Template:Ambox">Template:Ambox</a> (<a href="http://wiki.qt.io/index.php?title=Template:Ambox&amp;action=edit" title="Template:Ambox">view source</a>) </li><li><a href="http://wiki.qt.io/Template:Cleanup" title="Template:Cleanup">Template:Cleanup</a> (<a href="http://wiki.qt.io/index.php?title=Template:Cleanup&amp;action=edit" title="Template:Cleanup">view source</a>) </li></ul></div><p id="mw-returnto">Return to <a href="http://wiki.qt.io/ValueBasedAndPointerBasedTypes" title="ValueBasedAndPointerBasedTypes">ValueBasedAndPointerBasedTypes</a>.</p>
</div>								<div class="printfooter">
				Retrieved from "<a href="http://wiki.qt.io/ValueBasedAndPointerBasedTypes">http://wiki.qt.io/ValueBasedAndPointerBasedTypes</a>"				</div>
												<div id='catlinks' class='catlinks catlinks-allhidden'></div>												<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>
			<div id="mw-head">
				<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
	<h3 id="p-personal-label">Personal tools</h3>
	<ul>
<li id="pt-anonuserpage"><a href="http://wiki.qt.io/User:10.0.113.70" class="new" title="The user page for the IP address you are editing as [.]" accesskey=".">10.0.113.70</a></li><li id="pt-anontalk"><a href="http://wiki.qt.io/User_talk:10.0.113.70" class="new" title="Discussion about edits from this IP address [n]" accesskey="n">Talk for this IP address</a></li><li id="pt-login"><a href="http://wiki.qt.io/index.php?title=Special:QtLogin&amp;returnto=ValueBasedAndPointerBasedTypes" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Sign in</a></li>	</ul>
</div>
				<div id="left-navigation">
					<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
	<h3 id="p-namespaces-label">Namespaces</h3>
	<ul>
					<li  id="ca-nstab-main" class="selected"><span><a href="http://wiki.qt.io/ValueBasedAndPointerBasedTypes"  title="View the content page [c]" accesskey="c">Page</a></span></li>
					<li  id="ca-talk" class="new"><span><a href="http://wiki.qt.io/index.php?title=Talk:ValueBasedAndPointerBasedTypes&amp;action=edit&amp;redlink=1"  title="Discussion about the content page [t]" accesskey="t">Discussion</a></span></li>
			</ul>
</div>
<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
	<h3 id="mw-vector-current-variant">
		</h3>
	<h3 id="p-variants-label"><span>Variants</span><a href="#"></a></h3>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>
				</div>
				<div id="right-navigation">
					<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
	<h3 id="p-views-label">Views</h3>
	<ul>
					<li id="ca-view"><span><a href="http://wiki.qt.io/ValueBasedAndPointerBasedTypes" >Read</a></span></li>
					<li id="ca-viewsource" class="selected"><span><a href="http://wiki.qt.io/index.php?title=ValueBasedAndPointerBasedTypes&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
					<li id="ca-history" class="collapsible"><span><a href="http://wiki.qt.io/index.php?title=ValueBasedAndPointerBasedTypes&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
			</ul>
</div>
<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
	<h3 id="p-cactions-label"><span>Actions</span><a href="#"></a></h3>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>
<div id="p-search" role="search">
	<h3><label for="searchInput">Search</label></h3>
	<form action="http://wiki.qt.io/index.php" id="searchform">
					<div id="simpleSearch">
					<input type="search" name="search" placeholder="Search" title="Search Qt Wiki [f]" accesskey="f" id="searchInput" /><input type="hidden" value="Special:Search" name="title" /><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton" /><input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchButton" class="searchButton" />		</div>
	</form>
</div>
				</div>
			</div>
			<div id="mw-panel">
					<div id="p-logo" role="banner"><a style="background-image: url(http://wiki.qt.io/skins/common/images/wiki.png);" href="http://wiki.qt.io/Main_Page"  title="Visit the main page"></a></div>
				<div class="portal" role="navigation" id='p-navigation' aria-labelledby='p-navigation-label'>
	<h3 id='p-navigation-label'>Navigation</h3>
	<div class="body">
		<ul>
			<li id="n-mainpage-description"><a href="http://wiki.qt.io/Main_Page" title="Visit the main page [z]" accesskey="z">Main page</a></li>
			<li id="n-recentchanges"><a href="http://wiki.qt.io/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
			<li id="n-randompage"><a href="http://wiki.qt.io/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
			<li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>
		</ul>
	</div>
</div>
<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
	<h3 id='p-tb-label'>Tools</h3>
	<div class="body">
		<ul>
			<li id="t-whatlinkshere"><a href="http://wiki.qt.io/Special:WhatLinksHere/ValueBasedAndPointerBasedTypes" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
			<li id="t-recentchangeslinked"><a href="http://wiki.qt.io/Special:RecentChangesLinked/ValueBasedAndPointerBasedTypes" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
			<li id="t-specialpages"><a href="http://wiki.qt.io/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
			<li id="t-info"><a href="http://wiki.qt.io/index.php?title=ValueBasedAndPointerBasedTypes&amp;action=info">Page information</a></li>
		</ul>
	</div>
</div>
			</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-places">
											<li id="footer-places-terms"><a href='https://developer.qtcloudservices.com/legal/terms'>Käyttöehdot</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
					<li id="footer-poweredbyico">
						<a href="http://www.mediawiki.org/"><img src="http://wiki.qt.io/skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" width="88" height="31" /></a>
					</li>
				</ul>
						<div style="clear:both"></div>
		</div>
		<script>/*<![CDATA[*/window.jQuery && jQuery.ready();/*]]>*/</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.action.edit.collapsibleFooter","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","skins.vector.collapsibleNav"],null,true);
}</script>
<script src="http://wiki.qt.io/load.php?debug=false&amp;lang=en&amp;modules=site&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','http://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54043535-2', 'auto');
  ga('send', 'pageview');

</script>
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":176});
}</script>
	</body>

<!-- Mirrored from wiki.qt.io/index.php?title=ValueBasedAndPointerBasedTypes&action=edit by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 05 Nov 2015 13:00:53 GMT -->
</html>
