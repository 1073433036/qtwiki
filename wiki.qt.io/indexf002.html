<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">

<!-- Mirrored from wiki.qt.io/index.php?title=Chicken_Wranglers&action=edit by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 05 Nov 2015 11:59:26 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8" />
<title>View source for Chicken Wranglers - Qt Wiki</title>
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />
<meta name="generator" content="MediaWiki 1.23.3" />
<meta name="robots" content="noindex,nofollow" />
<link rel="shortcut icon" href="http://wiki.qt.io/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="http://wiki.qt.io/opensearch_desc.php" title="Qt Wiki (en)" />
<link rel="EditURI" type="application/rsd+xml" href="http://wiki.qt.io/api.php?action=rsd" />
<link rel="alternate" type="application/atom+xml" title="Qt Wiki Atom feed" href="http://wiki.qt.io/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="http://wiki.qt.io/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.skinning.interface%7Cmediawiki.ui.button%7Cskins.vector.styles&amp;only=styles&amp;skin=vector&amp;*" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="http://wiki.qt.io/load.php?debug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=vector&amp;*" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: qtio_wiki:resourceloader:filter:minify-css:7:e91d7bc946738c8892a88ad5616a59ba */</style>
<script src="http://wiki.qt.io/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Chicken_Wranglers","wgTitle":"Chicken Wranglers","wgCurRevisionId":8277,"wgRevisionId":0,"wgArticleId":601,"wgIsArticle":false,"wgIsRedirect":false,"wgAction":"edit","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":true,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Chicken_Wranglers","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"dialogs":true,"hidesig":true,"preview":true,"previewDialog":false,"publish":true}});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"editfont":"default","editondblclick":0,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":1,"extendwatchlist":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"imagesize":2,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nickname":"","norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"rcdays":7,"rclimit":50,"rows":25,"showhiddencats":0,"shownumberswatching":1,"showtoolbar":1,"skin":"vector","stubthreshold":0,"thumbsize":2,"underline":2,"uselivepreview":0,"usenewrc":0,"watchcreations":1,"watchdefault":1,"watchdeletion":0,"watchlistdays":3,"watchlisthideanons":0,"watchlisthidebots":0,"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"wllimit":250,
"useeditwarning":1,"prefershttps":1,"usebetatoolbar":1,"usebetatoolbar-cgd":1,"wikieditor-preview":1,"wikieditor-publish":1,"language":"en","variant-gan":"gan","variant-iu":"iu","variant-kk":"kk","variant-ku":"ku","variant-shi":"shi","variant-sr":"sr","variant-tg":"tg","variant-uz":"uz","variant-zh":"zh","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false,"searchNs500":false,"searchNs501":false,"searchNs700":false,"searchNs701":false,"variant":"en"});},{},{});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":false,"watchToken":false});},{},{});
/* cache key: qtio_wiki:resourceloader:filter:minify-js:7:9743cb8b8019d46de5946bfe6dfa04d7 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/vector/csshover.min.htc")}</style><![endif]--></head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Chicken_Wranglers skin-vector action-edit vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>
			<div id="mw-js-message" style="display:none;"></div>
						<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">View source for Chicken Wranglers</span></h1>
						<div id="bodyContent">
								<div id="contentSub">← <a href="http://wiki.qt.io/Chicken_Wranglers" title="Chicken Wranglers">Chicken Wranglers</a></div>
												<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="#mw-navigation">navigation</a>, 					<a href="#p-search">search</a>
				</div>
				<div id="mw-content-text"><p>You do not have permission to edit this page, for the following reason:
</p>
<div class="permissions-errors">
<p>The action you have requested is limited to users in one of the groups: <a href="http://wiki.qt.io/index.php?title=Qt_Wiki:Users&amp;action=edit&amp;redlink=1" class="new" title="Qt Wiki:Users (page does not exist)">Users</a>, KnowledgeBase, QtWS.
</p>
</div>
<hr />
<p>You can view and copy the source of this page:
</p><textarea readonly="" accesskey="," id="wpTextbox1" cols="80" rows="25" style="" lang="en" dir="ltr" name="wpTextbox1">=Chicken Wranglers – Showcase app=

''Listen to the INdT team in Brazil about how they used Qt to make a multiplayer and cross-device game using mobiles devices as the controllers.''

[https://www.youtube.com/watch?v=r98k10pLuEg YuoTube video]

The original premise of this project was the development of an application to showcase how Qt and &lt;span class="caps">QML&lt;/span> can support interoperability between different platforms and devices.

The idea started to shape as a cross-device game, where several players could use their mobiles as remote controls and a big screen as a main game board.

After several proposals being considered, the designers presented a quite charming and funny game concept: farmers trying to capture chickens on their hencoops, using laser walls to trap them.

The challenge ahead: how to implement this concept with a small team (with zero previous experience in &lt;span class="caps">QML&lt;/span> and no gaming development experience as well) in a really tight schedule?

If successful, this could be the perfect scenario to prove how was the &lt;span class="caps">QML&lt;/span> learning curve and how productive it could be.

==Game Development==

It was clear that some components would be required for assembling a multiplayer networked game, so the team decided to start implementing modules that could be used independently of how the idea would evolve. The demands at this stage were interoperability and client devices acting as remote controllers.

===The Mobile as a Remote control===

The first module to be developed was the game controller. For input the team decided to use the accelerometer sensor for moving the characters. Qt Mobility features a sensors module that provides access to the device accelerometers.

Character movements were quite simple (up, down, right, left, stop), being just a matter of capturing accelerometer data and converting to discrete directions. The main challenge here was to fine tune those values such that it wouldn’t be hard for the user to guide his character through the battlefield.

It required some degree of experimentation to achieve good thresholds for handling common commands. Some parameters were used to aid the calculations:

* The minimum angle the device needs to be rotated to trigger a direction change.
* A threshold between two directions in the same axis (e.g. up and stopped) so the controller does not keep oscillating between them.
* Direction changing timeout, to check if the time spent in a given direction is not too short. This avoids undesired direction changes.

===Connectivity===

Before working on the connectivity itself, it was defined a communication protocol (messages and states to be exchanged between the devices), targeting to support both &lt;span class="caps">WLAN&lt;/span> and bluetooth. Qt has great networking support, so it was relatively easy to implement connectivity via local network (therefore &lt;span class="caps">WLAN&lt;/span>).

Qt Mobility 1.2 offers bluetooth classes for device management (discovering, pairing, etc) and message interchanging. It maps closely to the networking classes, enabling the initial &lt;span class="caps">WLAN&lt;/span> code to be later translated to be used for bluetooth connections.

To support both &lt;span class="caps">WLAN&lt;/span> and Bluetooth connectivity it a common abstraction was created for representing a network connection (QBluetoothSocket and QTcpSocket don’t share the same immediate parent class), thus signals diverge in type signature besides being quite similar. This allowed the application to switch the type of connectivity used at run time.

===UI and Animation===

One major concern was on the visual aspects of the game: how to make rich user interface screens, fancy transitions and animations to look beautiful and run smoothly.

That is where &lt;span class="caps">QML&lt;/span> (Qt Modeling Language) came to the rescue. The team was formed by proficient programmers in C++/Qt/Linux but, as explained earlier, no previous experience with &lt;span class="caps">QML&lt;/span>.

It turned out to be a pleasant surprise how easy and intuitive was to implement animations and effects while building the user interface in a declarative way. The possibilities of integration between C++ and the declarative language were seamless, enabling logic coded in native code to easily plug into Javascript based &lt;span class="caps">QML&lt;/span>.

This way, we could keep the performance sensitive code paths in the native side (e.g. the chickens’ artificial intelligence, collision detection and connectivity, to name a few) and let only the visual implementation on the declarative side.

===Making Smart Chickens===

To make the chickens look like they are smart, it a module was created to add some intelligence to them. It basically changes the position of the chickens based on the proximity of the farmers or of hencoops. This logic enables the chickens to avoid wranglers and coops whenever possible and features a pseudo random criteria of avoidance, enriching the gaming experience.

The game elements (wranglers, hencoop, chickens, lasers) are logically represented on a matrix, in order to help the module to detect collisions and calculate the runaway logic.

===Porting and Optimizations===

The next step to fulfill the original vision of being truly cross-platform was a port to Symbian. The possibility of a port was only made possible starting with Qt Mobility 1.2 beta being made available (this is required to support bluetooth connectivity).

The first step was to change the buildsystem to couple with Symbian idiosyncrasies. While the initial buildsystem allowed to build different components as shared libraries (thus helping in debugging), to adapt to Symbian the application buildsystem was changed to build its submodules as a single project.

The app successfully launched in Symbian, but its memory footprint was above the maximum heapsize, as also the default stack size. These memory problems required some optimizations like using smaller image assets, installable character models (instead of using Qt resources for everything) and lazy loading of some screens.

Next, the screens got to be made more scalable (the game targeted the resolution of Nokia N900, which is bigger than Symbian devices like Nokia N8). The next step was to dynamically load assets depending on the environment and fine tune parameters animations (i.e. the feathers animation will use different number of feathers depending on the environment). This together with some reordering and refactoring of screen elements brought some benefits for CW in both environments, like faster app startup and better framerates. The end result was a reduction of memory usage from above 80MB to just 15MB of &lt;span class="caps">RAM&lt;/span>.

Finally, much improved frame rates were achieved by simply using a &lt;span class="caps">QGLW&lt;/span>idget thus unleashing OpenGL hardware acceleration for free. At end, we even got host mode to run successfully in the mobile (hosting up to 4 players at same time) with pretty good &lt;span class="caps">CPU&lt;/span> usage (load around 65%) and framerates.

==Conclusion==

Qt technologies made possible to write from scratch a game for mobile devices in a short schedule with a small team, enabling quick implementation of designer’s mockups into real code.

It features support for everything needed to turn ideas into a running application: networking, bluetooth, accelerometer and graphics. The fact that it is possible to use C++ for more complex code paths, brings a huge advantage while coding games.

Add a declarative way for UI development in the mix and you achieve a winning combination for rapid application development.&lt;br /> How to Play

Chicken Wranglers is a 2-4 players game, where each player is a farmer whose goal is to capture as much chickens as he can while a timer is running. The chickens walk freely across a bi-dimensional grid, always trying to escape from the farmers and their chicken coops.

In order to push chickens to his coop, the farmer can activate lasers in the grid to build mazes that should restrain the chickens’ path and guide them to the coop. The lasers can be placed at any edge of a cell (up, down, left or right) where the farmer is currently located. Although active lasers are supposed to help a farmer, the other farmers can deactivate any laser at any time. This enables a farmer to have his maze broken by his opponents.

Note that neither chickens nor farmers are allowed to cross a laser wall before it is deactivated.&lt;br /> Score

Each time a chicken cross a farmer’s coop, the corresponding player scores 1 point. After the timer expires, the player with the highest score wins.

[[Image:CW.png]]

''Ashley Walker holds the Chicken Wrangler title with wrangling all 40 chickens into the hen house before the clock ran out. She was undefeated at the MeeGo Conference this spring. Do you have what it takes to steal the CW title?''

==Controls==

'''Movement''' – A player controls his character direction via device accelerometer. The characters moves in four directions: up, down, left and right according to device tilting on any of those directions. If the device is tilted diagonally (e.g. up and left), the predominant direction will be the most tilted one.

'''Lasers''' – Tapping on screen toggles a laser on the corresponding direction of the player character’s position. For instance, if the player taps on the top of the screen, the laser is activated/deactivated above the character’s position.

==Binaries==

Harmattan (N9 / N950): http://get.qt.nokia.com/demos/chicken-wranglers/chicken-wranglers_0.1-0_harmattan_armel.deb

Fremantle (N900): http://get.qt.nokia.com/demos/chicken-wranglers/chicken-wranglers_0.1-0_fremantle_armel.deb

Ubuntu 11.04: http://get.qt.nokia.com/demos/chicken-wranglers/chicken-wranglers_0.1-0_i386.deb

==Source==

http://qt.gitorious.org/qt-labs/mobile-demos/trees/master/chicken-wranglers

[[Category:Developing with Qt]]
[[Category:Developing with Qt::Qt Quick]]
[[Category:Developing with Qt::Qt Quick::Demos]]
[[Category:Learning]]
[[Category:Learning::Demos and Examples]]
</textarea><div class="templatesUsed"></div><p id="mw-returnto">Return to <a href="http://wiki.qt.io/Chicken_Wranglers" title="Chicken Wranglers">Chicken Wranglers</a>.</p>
</div>								<div class="printfooter">
				Retrieved from "<a href="http://wiki.qt.io/Chicken_Wranglers">http://wiki.qt.io/Chicken_Wranglers</a>"				</div>
												<div id='catlinks' class='catlinks catlinks-allhidden'></div>												<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>
			<div id="mw-head">
				<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
	<h3 id="p-personal-label">Personal tools</h3>
	<ul>
<li id="pt-anonuserpage"><a href="http://wiki.qt.io/User:10.0.113.70" class="new" title="The user page for the IP address you are editing as [.]" accesskey=".">10.0.113.70</a></li><li id="pt-anontalk"><a href="http://wiki.qt.io/User_talk:10.0.113.70" class="new" title="Discussion about edits from this IP address [n]" accesskey="n">Talk for this IP address</a></li><li id="pt-login"><a href="http://wiki.qt.io/index.php?title=Special:QtLogin&amp;returnto=Chicken+Wranglers" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Sign in</a></li>	</ul>
</div>
				<div id="left-navigation">
					<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
	<h3 id="p-namespaces-label">Namespaces</h3>
	<ul>
					<li  id="ca-nstab-main" class="selected"><span><a href="http://wiki.qt.io/Chicken_Wranglers"  title="View the content page [c]" accesskey="c">Page</a></span></li>
					<li  id="ca-talk" class="new"><span><a href="http://wiki.qt.io/index.php?title=Talk:Chicken_Wranglers&amp;action=edit&amp;redlink=1"  title="Discussion about the content page [t]" accesskey="t">Discussion</a></span></li>
			</ul>
</div>
<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
	<h3 id="mw-vector-current-variant">
		</h3>
	<h3 id="p-variants-label"><span>Variants</span><a href="#"></a></h3>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>
				</div>
				<div id="right-navigation">
					<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
	<h3 id="p-views-label">Views</h3>
	<ul>
					<li id="ca-view"><span><a href="http://wiki.qt.io/Chicken_Wranglers" >Read</a></span></li>
					<li id="ca-viewsource" class="selected"><span><a href="http://wiki.qt.io/index.php?title=Chicken_Wranglers&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
					<li id="ca-history" class="collapsible"><span><a href="http://wiki.qt.io/index.php?title=Chicken_Wranglers&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
			</ul>
</div>
<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
	<h3 id="p-cactions-label"><span>Actions</span><a href="#"></a></h3>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>
<div id="p-search" role="search">
	<h3><label for="searchInput">Search</label></h3>
	<form action="http://wiki.qt.io/index.php" id="searchform">
					<div id="simpleSearch">
					<input type="search" name="search" placeholder="Search" title="Search Qt Wiki [f]" accesskey="f" id="searchInput" /><input type="hidden" value="Special:Search" name="title" /><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton" /><input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchButton" class="searchButton" />		</div>
	</form>
</div>
				</div>
			</div>
			<div id="mw-panel">
					<div id="p-logo" role="banner"><a style="background-image: url(http://wiki.qt.io/skins/common/images/wiki.png);" href="http://wiki.qt.io/Main_Page"  title="Visit the main page"></a></div>
				<div class="portal" role="navigation" id='p-navigation' aria-labelledby='p-navigation-label'>
	<h3 id='p-navigation-label'>Navigation</h3>
	<div class="body">
		<ul>
			<li id="n-mainpage-description"><a href="http://wiki.qt.io/Main_Page" title="Visit the main page [z]" accesskey="z">Main page</a></li>
			<li id="n-recentchanges"><a href="http://wiki.qt.io/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
			<li id="n-randompage"><a href="http://wiki.qt.io/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
			<li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>
		</ul>
	</div>
</div>
<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
	<h3 id='p-tb-label'>Tools</h3>
	<div class="body">
		<ul>
			<li id="t-whatlinkshere"><a href="http://wiki.qt.io/Special:WhatLinksHere/Chicken_Wranglers" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
			<li id="t-recentchangeslinked"><a href="http://wiki.qt.io/Special:RecentChangesLinked/Chicken_Wranglers" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
			<li id="t-specialpages"><a href="http://wiki.qt.io/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
			<li id="t-info"><a href="http://wiki.qt.io/index.php?title=Chicken_Wranglers&amp;action=info">Page information</a></li>
		</ul>
	</div>
</div>
			</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-places">
											<li id="footer-places-terms"><a href='https://developer.qtcloudservices.com/legal/terms'>Käyttöehdot</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
					<li id="footer-poweredbyico">
						<a href="http://www.mediawiki.org/"><img src="http://wiki.qt.io/skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" width="88" height="31" /></a>
					</li>
				</ul>
						<div style="clear:both"></div>
		</div>
		<script>/*<![CDATA[*/window.jQuery && jQuery.ready();/*]]>*/</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.action.edit.collapsibleFooter","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","skins.vector.collapsibleNav"],null,true);
}</script>
<script src="http://wiki.qt.io/load.php?debug=false&amp;lang=en&amp;modules=site&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','http://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54043535-2', 'auto');
  ga('send', 'pageview');

</script>
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":765});
}</script>
	</body>

<!-- Mirrored from wiki.qt.io/index.php?title=Chicken_Wranglers&action=edit by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 05 Nov 2015 11:59:26 GMT -->
</html>
