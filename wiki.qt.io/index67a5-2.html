<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">

<!-- Mirrored from wiki.qt.io/index.php?title=QML_for_JavaScript_programmers&printable=yes by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 05 Nov 2015 12:14:36 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8" />
<title>QML for JavaScript programmers - Qt Wiki</title>
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />
<meta name="generator" content="MediaWiki 1.23.3" />
<meta name="robots" content="noindex,follow" />
<link rel="shortcut icon" href="favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="Qt Wiki (en)" />
<link rel="EditURI" type="application/rsd+xml" href="api251f.php?action=rsd" />
<link rel="alternate" type="application/atom+xml" title="Qt Wiki Atom feed" href="apidf90.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="load6077.css?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.skinning.interface%7Cmediawiki.ui.button%7Cskins.vector.styles&amp;only=styles&amp;printable=1&amp;skin=vector&amp;*" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="load8b5e.css?debug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;printable=1&amp;skin=vector&amp;*" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: qtio_wiki:resourceloader:filter:minify-css:7:e91d7bc946738c8892a88ad5616a59ba */</style>
<script src="load041f.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;printable=1&amp;skin=vector&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"QML_for_JavaScript_programmers","wgTitle":"QML for JavaScript programmers","wgCurRevisionId":18605,"wgRevisionId":18605,"wgArticleId":1091,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Developing with Qt::Qt Quick","HowTo"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"QML_for_JavaScript_programmers","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"dialogs":true,"hidesig":true,"preview":true,"previewDialog":false,"publish":true}});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"editfont":"default","editondblclick":0,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":1,"extendwatchlist":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"imagesize":2,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nickname":"","norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"rcdays":7,"rclimit":50,"rows":25,"showhiddencats":0,"shownumberswatching":1,"showtoolbar":1,"skin":"vector","stubthreshold":0,"thumbsize":2,"underline":2,"uselivepreview":0,"usenewrc":0,"watchcreations":1,"watchdefault":1,"watchdeletion":0,"watchlistdays":3,"watchlisthideanons":0,"watchlisthidebots":0,"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"wllimit":250,
"useeditwarning":1,"prefershttps":1,"usebetatoolbar":1,"usebetatoolbar-cgd":1,"wikieditor-preview":1,"wikieditor-publish":1,"language":"en","variant-gan":"gan","variant-iu":"iu","variant-kk":"kk","variant-ku":"ku","variant-shi":"shi","variant-sr":"sr","variant-tg":"tg","variant-uz":"uz","variant-zh":"zh","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false,"searchNs500":false,"searchNs501":false,"searchNs700":false,"searchNs701":false,"variant":"en"});},{},{});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":false,"watchToken":false});},{},{});
/* cache key: qtio_wiki:resourceloader:filter:minify-js:7:9743cb8b8019d46de5946bfe6dfa04d7 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script>
<style type="text/css">/*<![CDATA[*/
.source-cpp-qt {line-height: normal;}
.source-cpp-qt li, .source-cpp-qt pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for cpp-qt
 * CSS class: source-cpp-qt, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.cpp-qt.source-cpp-qt .de1, .cpp-qt.source-cpp-qt .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.cpp-qt.source-cpp-qt  {font-family:monospace;}
.cpp-qt.source-cpp-qt .imp {font-weight: bold; color: red;}
.cpp-qt.source-cpp-qt li, .cpp-qt.source-cpp-qt .li1 {font-weight: normal; vertical-align:top;}
.cpp-qt.source-cpp-qt .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.cpp-qt.source-cpp-qt .li2 {font-weight: bold; vertical-align:top;}
.cpp-qt.source-cpp-qt .kw1 {color: #000000; font-weight:bold;}
.cpp-qt.source-cpp-qt .kw2 {color: #0057AE;}
.cpp-qt.source-cpp-qt .kw3 {color: #2B74C7;}
.cpp-qt.source-cpp-qt .kw4 {color: #0057AE;}
.cpp-qt.source-cpp-qt .kw5 {color: #22aadd;}
.cpp-qt.source-cpp-qt .co1 {color: #888888;}
.cpp-qt.source-cpp-qt .co2 {color: #006E28;}
.cpp-qt.source-cpp-qt .coMULTI {color: #888888; font-style: italic;}
.cpp-qt.source-cpp-qt .es0 {color: #000099; font-weight: bold;}
.cpp-qt.source-cpp-qt .es1 {color: #000099; font-weight: bold;}
.cpp-qt.source-cpp-qt .es2 {color: #660099; font-weight: bold;}
.cpp-qt.source-cpp-qt .es3 {color: #660099; font-weight: bold;}
.cpp-qt.source-cpp-qt .es4 {color: #660099; font-weight: bold;}
.cpp-qt.source-cpp-qt .es5 {color: #006699; font-weight: bold;}
.cpp-qt.source-cpp-qt .br0 {color: #006E28;}
.cpp-qt.source-cpp-qt .sy0 {color: #006E28;}
.cpp-qt.source-cpp-qt .st0 {color: #BF0303;}
.cpp-qt.source-cpp-qt .nu0 {color: #B08000;}
.cpp-qt.source-cpp-qt .nu6 {color: #208080;}
.cpp-qt.source-cpp-qt .nu8 {color: #208080;}
.cpp-qt.source-cpp-qt .nu12 {color: #208080;}
.cpp-qt.source-cpp-qt .nu16 {color:#800080;}
.cpp-qt.source-cpp-qt .nu17 {color:#800080;}
.cpp-qt.source-cpp-qt .nu18 {color:#800080;}
.cpp-qt.source-cpp-qt .nu19 {color:#800080;}
.cpp-qt.source-cpp-qt .me1 {color: #2B74C7;}
.cpp-qt.source-cpp-qt .me2 {color: #2B74C7;}
.cpp-qt.source-cpp-qt .me3 {color: #2B74C7;}
.cpp-qt.source-cpp-qt .ln-xtra, .cpp-qt.source-cpp-qt li.ln-xtra, .cpp-qt.source-cpp-qt div.ln-xtra {background-color: #ffc;}
.cpp-qt.source-cpp-qt span.xtra { display:block; }

/*]]>*/
</style><!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/vector/csshover.min.htc")}</style><![endif]--></head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-QML_for_JavaScript_programmers skin-vector action-view vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>
			<div id="mw-js-message" style="display:none;"></div>
						<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">QML for JavaScript programmers</span></h1>
						<div id="bodyContent">
								<div id="siteSub">From Qt Wiki</div>
								<div id="contentSub"></div>
												<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="#mw-navigation">navigation</a>, 					<a href="#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div style="background:#eeeeee;padding:2px;">
<p><strong class="selflink">En</strong>
<span style="color:#ccc;">Ar</span>
<span style="color:#ccc;">Bg</span>
<span style="color:#ccc;">De</span>
<span style="color:#ccc;">El</span>
<span style="color:#ccc;">Es</span>
<span style="color:#ccc;">Fa</span>
<span style="color:#ccc;">Fi</span>
<span style="color:#ccc;">Fr</span>
<span style="color:#ccc;">Hi</span>
<span style="color:#ccc;">Hu</span>
<span style="color:#ccc;">It</span>
<span style="color:#ccc;">Ja</span>
<span style="color:#ccc;">Kn</span>
<span style="color:#ccc;">Ko</span>
<span style="color:#ccc;">Ms</span>
<span style="color:#ccc;">Nl</span>
<span style="color:#ccc;">Pl</span>
<span style="color:#ccc;">Pt</span>
<span style="color:#ccc;">Ru</span>
<span style="color:#ccc;">Th</span>
<span style="color:#ccc;">Tr</span>
<span style="color:#ccc;">Uk</span>
<span style="color:#ccc;">Zh</span>
</p>
</div>
<p>Although QML is technically a JavaScript extension, there are few issues a JavaScript programmer needs to be aware before designing the application. The typical advice from the Qt folks is "QML is not meant for JavaScript but for C++ UI" or "JavaScript is slow and you should not use it" which is not very helpful. Although all those statements are honest and at least mostly true, rest assured that applications can be programmed without C++ as long as your user interface data structures are flat objects or single dimension arrays (lists) of objects. But there are few things to know first:
</p><p>The fundamental problem for the JavaScript programmer is that QML JavaScript is not really designed for JavaScript expressions but for Qt C++ objects. As the C++ and JavaScript data models are fundamentally different, the QML is designed to support only a limited set of the strongly typed QtObject derived objects and a superset of simple types over JavaScript types. Luckily, inside the JavaScript functions and namespace, you can use the full expressiveness of JavaScript but the interface between QML and JavaScript becomes C-like with named global variables declared in QML and passing the QML object references as arguments.
</p>
On the other hand, QML implements a beautiful namespace model for JavaScript. Each JavaScript file is loaded to a defined namespace in the beginning of the QML file: <div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="cpp-qt source-cpp-qt"><pre class="de1">import <span class="st0">'myapp.js'</span> as Code</pre></div></div> and any variables defined in the top level of the file gets loaded to the object "Code". Also implicitly any initialization code on the top level of the file will be executed on load.
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Design_pattern"><span class="tocnumber">1</span> <span class="toctext">Design pattern</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Code_for_a_single_threaded_app"><span class="tocnumber">2</span> <span class="toctext">Code for a single threaded app</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#myapp.js"><span class="tocnumber">2.1</span> <span class="toctext">myapp.js</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#MyApp.qml"><span class="tocnumber">2.2</span> <span class="toctext">MyApp.qml</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-5"><a href="#Code_for_an_app_with_UI_and_logic_in_separate_threads"><span class="tocnumber">3</span> <span class="toctext">Code for an app with UI and logic in separate threads</span></a>
<ul>
<li class="toclevel-2 tocsection-6"><a href="#My2ThreadApp.qml"><span class="tocnumber">3.1</span> <span class="toctext">My2ThreadApp.qml</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#my2threadapp.js"><span class="tocnumber">3.2</span> <span class="toctext">my2threadapp.js</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#app.qml"><span class="tocnumber">3.3</span> <span class="toctext">app.qml</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="Design_pattern">Design pattern</span></h2>
<p>The design pattern I have used is to split the application to
</p>
<ol>
<li> UI description in QML (<i>myapp.qml</i>)
</li>
<li> Application functionality in JavaScript (<i>myapp.js</i>)
</li>
<li> The Common data for both (in a well-defined place in the <i>myapp.qml</i>)
</li>
<li> Wrapper functions in QML file to create the "public api" between JavaScript and QML passing the necessary QML object references (in the <i>myapp.qml</i>).
</li>
</ol>
The main issue even with this composition is that QML can not handle the JavaScript dynamic data structures. Even though one can declare a <div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="cpp-qt source-cpp-qt"><pre class="de1">property variant a<span class="sy0">:</span> <span class="br0">&#91;</span><span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">2</span><span class="sy0">,</span> <span class="nu0">3</span><span class="br0">&#93;</span></pre></div></div> in QML, it is a readonly property. Any attempt to modify inside JavaScript silently (and miserably) fail. Do not waste your time attempting to hack yourself around it - you won't.
However, if you stick only to one-dimensional list and grid views in the UI, you'll be fine. The way to go is to use the built-in ListModel data structure as interface to JavaScript. It behaves quite like a JavaScript Array but with the limitation that all members have to be simple compound objects with exactly the same set of members, i.e list members can not be lists. The pattern is to define a empty ListModel in the QML as <div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="cpp-qt source-cpp-qt"><pre class="de1">property ListModel myListModel<span class="sy0">:</span> ListModel <span class="br0">&#123;</span><span class="br0">&#125;</span></pre></div></div> and wrap it with a JavaScript Array with all updates to the ListModel only through the wrapper and never use the ListModel member functions <div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="cpp-qt source-cpp-qt"><pre class="de1">.<span class="me1">get</span><span class="br0">&#40;</span><span class="br0">&#41;</span> .<span class="me1">set</span><span class="br0">&#40;</span><span class="br0">&#41;</span> .<span class="me1">clear</span><span class="br0">&#40;</span><span class="br0">&#41;</span> .<span class="me1">append</span><span class="br0">&#40;</span><span class="br0">&#41;</span></pre></div></div> etc. directly.
<h2><span class="mw-headline" id="Code_for_a_single_threaded_app">Code for a single threaded app</span></h2>
<p>Here is my very simple boilerplate for a single threaded app:
</p>
<h3><span class="mw-headline" id="myapp.js">myapp.js</span></h3>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="cpp-qt source-cpp-qt"><pre class="de1"><span class="coMULTI">/*
 * Array wrapper
 */</span>
&#160;
<span class="co1">// .attach() method to JavaScript Arrays: attaches a QML ListModel to an array</span>
Array.<span class="me1">prototype</span>.<span class="me1">attach</span> <span class="sy0">=</span> function<span class="br0">&#40;</span>listmodel<span class="br0">&#41;</span> <span class="br0">&#123;</span>
 <span class="kw1">this</span>._model <span class="sy0">=</span> listmodel<span class="sy0">;</span>
 <span class="kw1">this</span>.<span class="me1">flush</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
&#160;
<span class="co1">// .flush() method to JavaScript Arrays: updates the attached ListModel to the contents of the Array</span>
<span class="co1">// automatically creates a role &quot;value&quot; for the ListModel if the array is flat</span>
Array.<span class="me1">prototype</span>.<span class="me1">flush</span> <span class="sy0">=</span> function<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
 var i<span class="sy0">;</span>
 <span class="kw1">while</span> <span class="br0">&#40;</span><span class="kw1">this</span>.<span class="me1">model</span>.<span class="me1">count</span> <span class="sy0">&gt;</span> <span class="kw1">this</span>.<span class="me1">length</span><span class="br0">&#41;</span> <span class="kw1">this</span>.<span class="me1">model</span>.<span class="kw3">remove</span><span class="br0">&#40;</span><span class="kw1">this</span>.<span class="me1">model</span>.<span class="me1">count</span><span class="sy0">-</span><span class="nu0">1</span><span class="br0">&#41;</span><span class="sy0">;</span>
 <span class="kw1">for</span> <span class="br0">&#40;</span>i <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> i <span class="sy0">&lt;</span> <span class="kw1">this</span>.<span class="me1">model</span>.<span class="me1">count</span><span class="sy0">;</span> i<span class="sy0">++</span><span class="br0">&#41;</span> <span class="kw1">this</span>.<span class="me1">model</span>.<span class="me1">set</span><span class="br0">&#40;</span>i<span class="sy0">,</span> typeof <span class="kw1">this</span><span class="br0">&#91;</span>i<span class="br0">&#93;</span> <span class="sy0">=</span> <span class="st0">'object'</span>&#160;? <span class="kw1">this</span><span class="br0">&#91;</span>i<span class="br0">&#93;</span> <span class="sy0">:</span> <span class="br0">&#123;</span>value<span class="sy0">:</span> <span class="kw1">this</span><span class="br0">&#91;</span>i<span class="br0">&#93;</span><span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">for</span> <span class="br0">&#40;</span><span class="sy0">;</span>i <span class="sy0">&lt;</span> <span class="kw1">this</span>.<span class="me1">length</span><span class="sy0">;</span> i<span class="sy0">++</span><span class="br0">&#41;</span> <span class="kw1">this</span>.__model.<span class="me1">append</span><span class="br0">&#40;</span>typeof <span class="kw1">this</span><span class="br0">&#91;</span>i<span class="br0">&#93;</span> <span class="sy0">=</span> <span class="st0">'object'</span>&#160;? <span class="kw1">this</span><span class="br0">&#91;</span>i<span class="br0">&#93;</span> <span class="sy0">:</span> <span class="br0">&#123;</span>value<span class="sy0">:</span> <span class="kw1">this</span><span class="br0">&#91;</span>i<span class="br0">&#93;</span><span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="co1">// this.model.sync(); // The model.sync() is only for updates in WorkerScript - see next example</span>
<span class="br0">&#125;</span>
&#160;
<span class="coMULTI">/*
 * Application
 */</span>
var myArray <span class="sy0">=</span> <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="sy0">;</span> <span class="co1">// This is the array to work with, you can initialize it here</span>
&#160;
var init <span class="sy0">=</span> function<span class="br0">&#40;</span>listModel<span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="co1">// QML calls when ready</span>
 <span class="co1">// Do the final initializations here</span>
&#160;
 myArray.<span class="me1">attach</span><span class="br0">&#40;</span>listModel<span class="br0">&#41;</span><span class="sy0">;</span> <span class="co1">// And finally attach the listModel to the array</span>
<span class="br0">&#125;</span>
&#160;
var arrayClickedAt <span class="sy0">=</span> function<span class="br0">&#40;</span>index<span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="co1">// mouse click callback for the array item [i]</span>
 <span class="co1">// Do whatever magic needed to your array here..</span>
&#160;
 myArray.<span class="me1">flush</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span> <span class="co1">// and finally update the ListModel</span>
<span class="br0">&#125;</span></pre></div></div>
<h3><span class="mw-headline" id="MyApp.qml">MyApp.qml</span></h3>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="cpp-qt source-cpp-qt"><pre class="de1">import <span class="kw5">Qt</span> <span class="nu16">4.7</span>
import <span class="st0">&quot;myapp.js&quot;</span> as Code
&#160;
Rectangle <span class="br0">&#123;</span>
 id<span class="sy0">:</span> top
 width<span class="sy0">:</span> <span class="nu0">360</span>
 height<span class="sy0">:</span> <span class="nu0">360</span>
 property ListModel list<span class="sy0">:</span> ListModel <span class="br0">&#123;</span><span class="br0">&#125;</span>
 Component.<span class="me1">onCompleted</span><span class="sy0">:</span> Code.<span class="me1">init</span><span class="br0">&#40;</span>top.<span class="me1">list</span><span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
 Component <span class="br0">&#123;</span>
 id<span class="sy0">:</span> delegate
 Text <span class="br0">&#123;</span> <span class="co1">// or whatever item</span>
 MouseArea <span class="br0">&#123;</span> <span class="co1">// Item click handler</span>
 anchors.<span class="me1">fill</span><span class="sy0">:</span> parent
 onClicked<span class="sy0">:</span> Code.<span class="me1">listClickedAt</span><span class="br0">&#40;</span>index<span class="br0">&#41;</span><span class="sy0">;</span> <span class="co1">// implement the click handler in the JavaScript</span>
 <span class="br0">&#125;</span>
 <span class="co1">// Implement delegate with full access to the array element properties. Use the role &quot;value&quot; if the array is flat</span>
 text<span class="sy0">:</span> value
 <span class="br0">&#125;</span>
 <span class="br0">&#125;</span>
&#160;
 ListView <span class="br0">&#123;</span>
 anchors.<span class="me1">fill</span><span class="sy0">:</span> parent
 model<span class="sy0">:</span> top.<span class="me1">list</span><span class="sy0">;</span>
 delegate<span class="sy0">:</span> delegate<span class="sy0">;</span>
 <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre></div></div>
<p>QML supports also the concept of a worker thread with nice integration to the ListModel, although the thread pool size seems to be only one in the current implementation. Worker code can not access the properties on the main thread and thus data needs to be passed through messages. ListModel is a special case and has a special .sync() method that can be conveniently integrated to the array wrapper.
</p>
<h2><span class="mw-headline" id="Code_for_an_app_with_UI_and_logic_in_separate_threads">Code for an app with UI and logic in separate threads</span></h2>
<p>Here is the boilerplate for an app with UI and app logic in separate threads. Example takes long to populate 40 Fibonacci numbers to an array but shows the UI immediately.
</p><p>Compare this code to the previous.
</p>
<h3><span class="mw-headline" id="My2ThreadApp.qml">My2ThreadApp.qml</span></h3>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="cpp-qt source-cpp-qt"><pre class="de1">import <span class="kw5">Qt</span> <span class="nu16">4.7</span>
&#160;
Rectangle <span class="br0">&#123;</span>
 id<span class="sy0">:</span> top
 width<span class="sy0">:</span> <span class="nu0">400</span>
 height<span class="sy0">:</span> <span class="nu0">800</span>
 property ListModel list<span class="sy0">:</span> ListModel <span class="br0">&#123;</span><span class="br0">&#125;</span>
 Component.<span class="me1">onCompleted</span><span class="sy0">:</span> werk.<span class="me1">sendMessage</span><span class="br0">&#40;</span><span class="br0">&#123;</span>msg<span class="sy0">:</span> <span class="st0">&quot;init&quot;</span><span class="sy0">,</span> arg<span class="sy0">:</span> top.<span class="me1">list</span><span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
 WorkerScript <span class="br0">&#123;</span>
 id<span class="sy0">:</span> werk
 source<span class="sy0">:</span> <span class="st0">&quot;my2threadap.js&quot;</span>
 <span class="br0">&#125;</span>
&#160;
 Component <span class="br0">&#123;</span>
 id<span class="sy0">:</span> delegate
 Text <span class="br0">&#123;</span> <span class="co1">// or whatever item</span>
 MouseArea <span class="br0">&#123;</span> <span class="co1">// Item click handler</span>
 anchors.<span class="me1">fill</span><span class="sy0">:</span> parent
 onClicked<span class="sy0">:</span> werk.<span class="me1">sendMessage</span><span class="br0">&#40;</span><span class="br0">&#123;</span>msg<span class="sy0">:</span> <span class="st0">&quot;click&quot;</span><span class="sy0">,</span> arg<span class="sy0">:</span> index<span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span> <span class="co1">// implement the click handler in the JavaScript</span>
 <span class="br0">&#125;</span>
 <span class="co1">// Implement delegate with full access to the array element properties. Use the role &quot;value&quot; if the array is flat</span>
 text<span class="sy0">:</span> value
 <span class="br0">&#125;</span>
 <span class="br0">&#125;</span>
&#160;
 ListView <span class="br0">&#123;</span>
 anchors.<span class="me1">fill</span><span class="sy0">:</span> parent
 model<span class="sy0">:</span> top.<span class="me1">list</span><span class="sy0">;</span>
 delegate<span class="sy0">:</span> delegate<span class="sy0">;</span>
 <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre></div></div>
<h3><span class="mw-headline" id="my2threadapp.js">my2threadapp.js</span></h3>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="cpp-qt source-cpp-qt"><pre class="de1"><span class="co1">// .attach() method to JavaScript Arrays: attaches a QML ListModel to an array</span>
Array.<span class="me1">prototype</span>.<span class="me1">attach</span> <span class="sy0">=</span> function<span class="br0">&#40;</span>listmodel<span class="br0">&#41;</span> <span class="br0">&#123;</span>
 <span class="kw1">this</span>.<span class="me1">model</span> <span class="sy0">=</span> listmodel<span class="sy0">;</span>
 <span class="kw1">this</span>.<span class="me1">flush</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
&#160;
<span class="co1">// .flush() method to JavaScript Arrays: updates the attached ListModel to the contents of the Array</span>
<span class="co1">// automatically creates a role &quot;value&quot; for the ListModel if the array is flat</span>
Array.<span class="me1">prototype</span>.<span class="me1">flush</span> <span class="sy0">=</span> function<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
 var i<span class="sy0">;</span>
 <span class="kw1">while</span> <span class="br0">&#40;</span><span class="kw1">this</span>.<span class="me1">model</span>.<span class="me1">count</span> <span class="sy0">&gt;</span> <span class="kw1">this</span>.<span class="me1">length</span><span class="br0">&#41;</span> <span class="kw1">this</span>.<span class="me1">model</span>.<span class="kw3">remove</span><span class="br0">&#40;</span><span class="kw1">this</span>.<span class="me1">model</span>.<span class="me1">count</span><span class="sy0">-</span><span class="nu0">1</span><span class="br0">&#41;</span><span class="sy0">;</span>
 <span class="kw1">for</span> <span class="br0">&#40;</span>i <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> i <span class="sy0">&lt;</span> <span class="kw1">this</span>.<span class="me1">model</span>.<span class="me1">count</span><span class="sy0">;</span> i<span class="sy0">++</span><span class="br0">&#41;</span> <span class="kw1">this</span>.<span class="me1">model</span>.<span class="me1">set</span><span class="br0">&#40;</span>i<span class="sy0">,</span> typeof <span class="kw1">this</span><span class="br0">&#91;</span>i<span class="br0">&#93;</span> <span class="sy0">=</span> <span class="st0">'object'</span>&#160;? <span class="kw1">this</span><span class="br0">&#91;</span>i<span class="br0">&#93;</span> <span class="sy0">:</span> <span class="br0">&#123;</span>value<span class="sy0">:</span> <span class="kw1">this</span><span class="br0">&#91;</span>i<span class="br0">&#93;</span><span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">for</span> <span class="br0">&#40;</span><span class="sy0">;</span>i <span class="sy0">&lt;</span> <span class="kw1">this</span>.<span class="me1">length</span><span class="sy0">;</span> i<span class="sy0">++</span><span class="br0">&#41;</span> <span class="kw1">this</span>.__model.<span class="me1">append</span><span class="br0">&#40;</span>typeof <span class="kw1">this</span><span class="br0">&#91;</span>i<span class="br0">&#93;</span> <span class="sy0">=</span> <span class="st0">'object'</span>&#160;? <span class="kw1">this</span><span class="br0">&#91;</span>i<span class="br0">&#93;</span> <span class="sy0">:</span> <span class="br0">&#123;</span>value<span class="sy0">:</span> <span class="kw1">this</span><span class="br0">&#91;</span>i<span class="br0">&#93;</span><span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span>
 <span class="kw1">this</span>._model.<span class="me1">sync</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span> <span class="co1">// The model.sync() is for updates in WorkerScript</span>
<span class="br0">&#125;</span>
&#160;
function fibonacci<span class="br0">&#40;</span>n<span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="co1">// heavy computing</span>
 <span class="kw1">if</span> <span class="br0">&#40;</span>n <span class="sy0">&lt;</span> <span class="nu0">3</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
 <span class="kw1">return</span> <span class="nu0">1</span><span class="sy0">;</span>
 <span class="br0">&#125;</span> <span class="kw1">else</span> <span class="br0">&#123;</span>
 <span class="kw1">return</span> fibonacci<span class="br0">&#40;</span>n<span class="sy0">-</span><span class="nu0">1</span><span class="br0">&#41;</span><span class="sy0">+</span>fibonacci<span class="br0">&#40;</span>n<span class="sy0">-</span><span class="nu0">2</span><span class="br0">&#41;</span><span class="sy0">;</span>
 <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&#160;
var myArray <span class="sy0">=</span> <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="sy0">;</span> <span class="co1">// This is the array to work with</span>
&#160;
var init <span class="sy0">=</span> function<span class="br0">&#40;</span>list<span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="co1">// QML is ready</span>
 var i<span class="sy0">,</span> v<span class="sy0">;</span>
&#160;
 myArray.<span class="me1">attach</span><span class="br0">&#40;</span>list<span class="br0">&#41;</span><span class="sy0">;</span> <span class="co1">// Attach the top.list ListModel to the array</span>
&#160;
 <span class="kw1">for</span> <span class="br0">&#40;</span>i <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> i <span class="sy0">&lt;</span> <span class="nu0">40</span> <span class="sy0">;</span> i<span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="co1">// fill the array, this loop takes a long time</span>
 myArray<span class="br0">&#91;</span>i<span class="br0">&#93;</span> <span class="sy0">=</span> fibonacci<span class="br0">&#40;</span>i<span class="sy0">+</span><span class="nu0">1</span><span class="br0">&#41;</span><span class="sy0">;</span>
 myArray.<span class="me1">flush</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span> <span class="co1">// update the ListModel</span>
 <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&#160;
var listClickedAt <span class="sy0">=</span> function<span class="br0">&#40;</span>index<span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="co1">// mouse click callback for the array item [i]</span>
 var half<span class="sy0">,</span> i<span class="sy0">;</span>
&#160;
 <span class="kw1">if</span> <span class="br0">&#40;</span>index <span class="sy0">===</span> <span class="nu0">0</span><span class="br0">&#41;</span> return<span class="sy0">;</span>
 half <span class="sy0">=</span> myArray.<span class="me1">splice</span><span class="br0">&#40;</span>index<span class="sy0">,</span> myArray.<span class="me1">length</span><span class="sy0">-</span>index<span class="br0">&#41;</span><span class="sy0">;</span>
 myArray.<span class="me1">unshift</span><span class="br0">&#40;</span>half.<span class="me1">shift</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
 <span class="kw1">for</span> <span class="br0">&#40;</span>i <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> i <span class="sy0">&lt;</span> half.<span class="me1">length</span><span class="sy0">;</span> i<span class="br0">&#41;</span> myArray.<span class="me1">push</span><span class="br0">&#40;</span>half<span class="br0">&#91;</span>i<span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
 myArray.<span class="me1">flush</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span> <span class="co1">// update the ListModel</span>
<span class="br0">&#125;</span>
&#160;
var messages <span class="sy0">=</span> <span class="br0">&#123;</span>
 click<span class="sy0">:</span> listClickedAt<span class="sy0">,</span>
 init<span class="sy0">:</span> init
 <span class="br0">&#125;</span><span class="sy0">;</span>
&#160;
WorkerScript<span class="sy0">&lt;</span> webdata.<span class="me1">count</span><span class="sy0">;</span> i<span class="sy0">++</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
 Code.<span class="me1">processElement</span><span class="br0">&#40;</span>webdata.<span class="me1">get</span><span class="br0">&#40;</span>i<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
 <span class="br0">&#125;</span>
 <span class="br0">&#125;</span>
 <span class="br0">&#125;</span>
 <span class="br0">&#125;</span>
<span class="co1">// ...</span>
<span class="br0">&#125;</span></pre></div></div>
<p>JavaScript is loaded to the same scope as the QML and thus can access any QML element by id. However, I find it most convenient to collect all properties that are shared between QML and JavaScript under one QtObject and pass it to the JavaScript side init() as argument to keep the object naming in control.
</p>
<h3><span class="mw-headline" id="app.qml">app.qml</span></h3>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="cpp-qt source-cpp-qt"><pre class="de1">import <span class="st0">&quot;app.js&quot;</span> as Code
<span class="co1">// ...</span>
 QtObject <span class="br0">&#123;</span>
 id<span class="sy0">:</span> common
 property <span class="kw4">int</span> n<span class="sy0">;</span> <span class="co1">// typeof a = 'number';</span>
  property string s<span class="sy0">;</span> <span class="co1">// typeof s = 'string'</span>
 property ListElement list<span class="sy0">:</span> ListElement <span class="br0">&#123;</span><span class="br0">&#125;</span>
 Component.<span class="me1">onCompleted</span><span class="sy0">:</span> Code.<span class="me1">init</span><span class="br0">&#40;</span>common<span class="br0">&#41;</span><span class="sy0">;</span>
 <span class="br0">&#125;</span></pre></div></div>
<p>In fact, as JavaScript misses the capability to store JSON to the device local storage, I eventually ended up extending this concept with implementing a Storage component that persistently stores all its properties across application executions and does the Array augmentation. And it is 100% JavaScript. Duh.
</p>
<!-- 
NewPP limit report
CPU time usage: 0.191 seconds
Real time usage: 0.197 seconds
Preprocessor visited node count: 203/1000000
Preprocessor generated node count: 807/1000000
Post‐expand include size: 2443/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 3/40
Expensive parser function count: 23/100
-->

<!-- Saved in parser cache with key qtio_wiki:pcache:idhash:1091-0!*!*!!en!*!* and timestamp 20151105100256 and revision id 18605
 -->
</div>								<div class="printfooter">
				Retrieved from "<a href="index797c.html?title=QML_for_JavaScript_programmers&amp;oldid=18605">http://wiki.qt.io/index.php?title=QML_for_JavaScript_programmers&amp;oldid=18605</a>"				</div>
												<div id='catlinks' class='catlinks'><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="Special_Categories.html" title="Special:Categories">Categories</a>: <ul><li><a href="Category_Developing_with_Qt__Qt_Quick.html" title="Category:Developing with Qt::Qt Quick">Developing with Qt::Qt Quick</a></li><li><a href="Category_HowTo.html" title="Category:HowTo">HowTo</a></li></ul></div></div>												<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>
			<div id="mw-head">
				<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
	<h3 id="p-personal-label">Personal tools</h3>
	<ul>
<li id="pt-anonuserpage"><a href="User_10.0.113.html" class="new" title="The user page for the IP address you are editing as [.]" accesskey=".">10.0.113.70</a></li><li id="pt-anontalk"><a href="User_talk_10.0.113.html" class="new" title="Discussion about edits from this IP address [n]" accesskey="n">Talk for this IP address</a></li><li id="pt-login"><a href="https://login.qt.io/authorize?client_id=one-qt-server-003&amp;response_type=code&amp;state=15420a6a233cf4f2&amp;scope=authorizations&amp;redirect_uri=https%3A%2F%2Fwiki.qt.io%2FSpecial%3AQtLogin%2Fcallback" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Sign in</a></li>	</ul>
</div>
				<div id="left-navigation">
					<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
	<h3 id="p-namespaces-label">Namespaces</h3>
	<ul>
					<li  id="ca-nstab-main" class="selected"><span><a href="QML_for_JavaScript_programmers.html"  title="View the content page [c]" accesskey="c">Page</a></span></li>
					<li  id="ca-talk" class="new"><span><a href="Talk_QML_for_JavaScript_programmers.html?title=Talk:QML_for_JavaScript_programmers&amp;action=edit&amp;redlink=1"  title="Discussion about the content page [t]" accesskey="t">Discussion</a></span></li>
			</ul>
</div>
<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
	<h3 id="mw-vector-current-variant">
		</h3>
	<h3 id="p-variants-label"><span>Variants</span><a href="#"></a></h3>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>
				</div>
				<div id="right-navigation">
					<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
	<h3 id="p-views-label">Views</h3>
	<ul>
					<li id="ca-view" class="selected"><span><a href="QML_for_JavaScript_programmers.html" >Read</a></span></li>
					<li id="ca-viewsource"><span><a href="index053c.html?title=QML_for_JavaScript_programmers&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
					<li id="ca-history" class="collapsible"><span><a href="index5169.html?title=QML_for_JavaScript_programmers&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
			</ul>
</div>
<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
	<h3 id="p-cactions-label"><span>Actions</span><a href="#"></a></h3>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>
<div id="p-search" role="search">
	<h3><label for="searchInput">Search</label></h3>
	<form action="http://wiki.qt.io/index.php" id="searchform">
					<div id="simpleSearch">
					<input type="search" name="search" placeholder="Search" title="Search Qt Wiki [f]" accesskey="f" id="searchInput" /><input type="hidden" value="Special:Search" name="title" /><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton" /><input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchButton" class="searchButton" />		</div>
	</form>
</div>
				</div>
			</div>
			<div id="mw-panel">
					<div id="p-logo" role="banner"><a style="background-image: url(skins/common/images/wiki.png);" href="Main_Page.html"  title="Visit the main page"></a></div>
				<div class="portal" role="navigation" id='p-navigation' aria-labelledby='p-navigation-label'>
	<h3 id='p-navigation-label'>Navigation</h3>
	<div class="body">
		<ul>
			<li id="n-mainpage-description"><a href="Main_Page.html" title="Visit the main page [z]" accesskey="z">Main page</a></li>
			<li id="n-recentchanges"><a href="Special_RecentChanges.html" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
			<li id="n-randompage"><a href="How_to_create_columns_in_a_QML_ListView.html" title="Load a random page [x]" accesskey="x">Random page</a></li>
			<li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>
		</ul>
	</div>
</div>
<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
	<h3 id='p-tb-label'>Tools</h3>
	<div class="body">
		<ul>
			<li id="t-whatlinkshere"><a href="Special_WhatLinksHere/QML_for_JavaScript_programmers.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
			<li id="t-recentchangeslinked"><a href="Special_RecentChangesLinked/QML_for_JavaScript_programmers.html" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
			<li id="t-specialpages"><a href="Special_SpecialPages.html" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
			<li id="t-permalink"><a href="index797c.html?title=QML_for_JavaScript_programmers&amp;oldid=18605" title="Permanent link to this revision of the page">Permanent link</a></li>
			<li id="t-info"><a href="indexe22e.html?title=QML_for_JavaScript_programmers&amp;action=info">Page information</a></li>
		</ul>
	</div>
</div>
			</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-info">
											<li id="footer-info-lastmod"> This page was last modified on 28 June 2015, at 20:18.</li>
											<li id="footer-info-viewcount">This page has been accessed 2,780 times.</li>
									</ul>
							<ul id="footer-places">
											<li id="footer-places-terms"><a href='https://developer.qtcloudservices.com/legal/terms'>Käyttöehdot</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
					<li id="footer-poweredbyico">
						<a href="http://www.mediawiki.org/"><img src="skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" width="88" height="31" /></a>
					</li>
				</ul>
						<div style="clear:both"></div>
		</div>
		<script>/*<![CDATA[*/window.jQuery && jQuery.ready();/*]]>*/</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","skins.vector.collapsibleNav"],null,true);
}</script>
<script src="load2f85.php?debug=false&amp;lang=en&amp;modules=site&amp;only=scripts&amp;printable=1&amp;skin=vector&amp;*"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','http://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54043535-2', 'auto');
  ga('send', 'pageview');

</script>
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":181});
}</script>
	</body>

<!-- Mirrored from wiki.qt.io/index.php?title=QML_for_JavaScript_programmers&printable=yes by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 05 Nov 2015 12:14:36 GMT -->
</html>
