<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">

<!-- Mirrored from wiki.qt.io/index.php?title=Qt-contributors-summit-2013-18836&action=edit by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 05 Nov 2015 14:18:07 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8" />
<title>View source for Qt-contributors-summit-2013-18836 - Qt Wiki</title>
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />
<meta name="generator" content="MediaWiki 1.23.3" />
<meta name="robots" content="noindex,nofollow" />
<link rel="shortcut icon" href="http://wiki.qt.io/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="http://wiki.qt.io/opensearch_desc.php" title="Qt Wiki (en)" />
<link rel="EditURI" type="application/rsd+xml" href="http://wiki.qt.io/api.php?action=rsd" />
<link rel="alternate" type="application/atom+xml" title="Qt Wiki Atom feed" href="http://wiki.qt.io/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="http://wiki.qt.io/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.skinning.interface%7Cmediawiki.ui.button%7Cskins.vector.styles&amp;only=styles&amp;skin=vector&amp;*" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="http://wiki.qt.io/load.php?debug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=vector&amp;*" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: qtio_wiki:resourceloader:filter:minify-css:7:e91d7bc946738c8892a88ad5616a59ba */</style>
<script src="http://wiki.qt.io/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Qt-contributors-summit-2013-18836","wgTitle":"Qt-contributors-summit-2013-18836","wgCurRevisionId":19319,"wgRevisionId":0,"wgArticleId":2267,"wgIsArticle":false,"wgIsRedirect":false,"wgAction":"edit","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":true,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Qt-contributors-summit-2013-18836","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"dialogs":true,"hidesig":true,"preview":true,"previewDialog":false,"publish":true}});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"editfont":"default","editondblclick":0,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":1,"extendwatchlist":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"imagesize":2,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nickname":"","norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"rcdays":7,"rclimit":50,"rows":25,"showhiddencats":0,"shownumberswatching":1,"showtoolbar":1,"skin":"vector","stubthreshold":0,"thumbsize":2,"underline":2,"uselivepreview":0,"usenewrc":0,"watchcreations":1,"watchdefault":1,"watchdeletion":0,"watchlistdays":3,"watchlisthideanons":0,"watchlisthidebots":0,"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"wllimit":250,
"useeditwarning":1,"prefershttps":1,"usebetatoolbar":1,"usebetatoolbar-cgd":1,"wikieditor-preview":1,"wikieditor-publish":1,"language":"en","variant-gan":"gan","variant-iu":"iu","variant-kk":"kk","variant-ku":"ku","variant-shi":"shi","variant-sr":"sr","variant-tg":"tg","variant-uz":"uz","variant-zh":"zh","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false,"searchNs500":false,"searchNs501":false,"searchNs700":false,"searchNs701":false,"variant":"en"});},{},{});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":false,"watchToken":false});},{},{});
/* cache key: qtio_wiki:resourceloader:filter:minify-js:7:9743cb8b8019d46de5946bfe6dfa04d7 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/vector/csshover.min.htc")}</style><![endif]--></head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Qt-contributors-summit-2013-18836 skin-vector action-edit vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>
			<div id="mw-js-message" style="display:none;"></div>
						<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">View source for Qt-contributors-summit-2013-18836</span></h1>
						<div id="bodyContent">
								<div id="contentSub">← <a href="http://wiki.qt.io/Qt-contributors-summit-2013-18836" title="Qt-contributors-summit-2013-18836">Qt-contributors-summit-2013-18836</a></div>
												<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="#mw-navigation">navigation</a>, 					<a href="#p-search">search</a>
				</div>
				<div id="mw-content-text"><p>You do not have permission to edit this page, for the following reason:
</p>
<div class="permissions-errors">
<p>The action you have requested is limited to users in one of the groups: <a href="http://wiki.qt.io/index.php?title=Qt_Wiki:Users&amp;action=edit&amp;redlink=1" class="new" title="Qt Wiki:Users (page does not exist)">Users</a>, KnowledgeBase, QtWS.
</p>
</div>
<hr />
<p>You can view and copy the source of this page:
</p><textarea readonly="" accesskey="," id="wpTextbox1" cols="80" rows="25" style="" lang="en" dir="ltr" name="wpTextbox1">{{Cleanup | reason=Auto-imported from ExpressionEngine.}}

&lt;span class="lighttext">Revision from: 14:54, 8 Jul 2013&lt;/span>&lt;br />&lt;br />

&lt;span class="caps">WIP&lt;/span>

=&lt;span class="caps">ICU&lt;/span> and Qt=

At QtCS 2012 it was decided to migrate to using &lt;span class="caps">ICU&lt;/span> for all localization services, effectively making it a hard requirement for Qt5. Since then a number of technical and political objections have been raised which need to be addressed. This session is to discuss the problems and try come up with a solution.

==Current use of &lt;span class="caps">ICU&lt;/span>==

* QtWebKit – required on all platforms for localization and text layout.
* QtCore / QIcuCodec – private, optional
* QtCore / QCollator – private, optional
* QtCore / QLocale for toUpper() and toLower() – private, optional
* sqlite3?

==Proposed use of &lt;span class="caps">ICU&lt;/span>==

It was proposed to use &lt;span class="caps">ICU&lt;/span> for all localization functions and data on all platforms, both the default locale and for any custom locales., and possibly for more Unicode code tables, etc. This would make &lt;span class="caps">ICU&lt;/span> a hard requirement for all Qt5 builds.

==Issues with &lt;span class="caps">ICU&lt;/span>==

===Common===

&lt;span class="caps">ICU&lt;/span> are notoriously bad at building libraries that can be reliably linked against, they offer no BC guarantees for C++, changing so names, dat files tightly coupled to library version, etc. For compatibility this leaves us to use the C api which lacks many of the advanced features in the C++ api that make using it desirable. C &lt;span class="caps">API&lt;/span> additions to match can be requested and some have been added as a result, but old system versions shipped in &lt;span class="caps">OSX&lt;/span> and Linux won't have these available. To use the C++ api would require strictly controlling the version of &lt;span class="caps">ICU&lt;/span> linked to, i.e. building it ourselves.

&lt;span class="caps">ICU&lt;/span> respects the users locale code (e.g. en_GB) but doesn't use the system default settings or the users custom settings (e.g. different date format), so &lt;span class="caps">ICU&lt;/span> apps may not fully fit in with a users environment. This may especially be a problem on Windows where settings and behaviour are very different from the &lt;span class="caps">POSIX&lt;/span> world.

The default &lt;span class="caps">ICU&lt;/span> data package is fairly large, up to 18MB, but not all data is actually required such as code tables and could easily be shrunk to about 4MB. &lt;span class="caps">ICU&lt;/span> libraries and approx size:

{| class="infotable line"
! Library
! Linux Filename
! Linux Size
|-
| Data Library
| libicudata
| 17 MB
|-
| Common Library
| libicuuc
| 1.5 MB
|-
| i18n Library
| libicu18n
| 2 MB
|-
| I/O Library (optional)
| libicuio
| 55 KB
|-
| Font Layout Library (optional)
| libicule
| 265 KB
|-
| Font Layout Extension Library (optional)
| libiculx
| 50 KB
|-
| Tool Utility Library (optional)
| libicutu
| 170 KB
|}

===QtWebKit===

WebKit provides a localization, text layout and string encoding abstraction layer. WebKit ports such as QtWebKit can provide their own backend but apparently most choose to use the existing &lt;span class="caps">ICU&lt;/span> back-end for convenience. QtWebKit4 apparently used to use QLocale/QString but switched to &lt;span class="caps">ICU&lt;/span> for Qt5? This means QtWebKit needs and uses &lt;span class="caps">ICU&lt;/span> on all platforms and so may not always properly fit in, whereas other system-provided WebKit ports may actually use the native api and so fit in better. Need to determine exactly what QtWebKit uses from &lt;span class="caps">ICU&lt;/span> and whether current approach is still best. Also an issue that by using &lt;span class="caps">ICU&lt;/span> for localization may get different results than QLocale may provide for the rest of the app.

WebKit / QtWebKit has 4 copies of the &lt;span class="caps">ICU&lt;/span> headers included in it's source tree required to build on Mac 10.4.

WebKit / QtWebKit uses the &lt;span class="caps">ICU&lt;/span> C++ api meaning it is tied to the specific &lt;span class="caps">ICU&lt;/span> version it is built against, so Linux distro's must already be coping with the &lt;span class="caps">ICU&lt;/span> upgrade situation, i.e rebuildign QtWebKit and Chromium as required.

See https://groups.google.com/a/chromium.org/forum/#!msg/blink-dev/eSiHBND2rAQ/X9LyMHImNjgJ for an interesting discussion on using &lt;span class="caps">ICU&lt;/span> in WebKit / Blink.

Build appears to only link against core and i18n libraries.

qtwebkit/Source/WebCore/platform/text/&lt;br /> LineBreakIteratorPoolICU.h&lt;br /> LocaleICU.h/.cpp&lt;br /> LocaleToScriptMappingICU.cpp&lt;br /> TextBreakIteratorICU.h/.cpp&lt;br /> TextCodecICU.h/.cpp&lt;br /> TextEncodingDetector.cpp

All &lt;span class="caps">ICU&lt;/span> includes in QtWebKit, not all are built by QtWebKit:&lt;br /> Source/JavaScriptCore/runtime/DatePrototype.cpp:#include &lt;unicode/udat.h>&lt;br /> Source/WebCore/editing/SmartReplaceICU.cpp:#include &lt;unicode/uset.h>&lt;br /> Source/WebCore/editing/TextIterator.cpp:#include &lt;unicode/usearch.h>&lt;br /> Source/WebCore/platform/graphics/SurrogatePairAwareTextIterator.cpp:#include &lt;unicode/unorm.h>&lt;br /> Source/WebCore/platform/graphics/win/SimpleFontDataCGWin.cpp:#include &lt;unicode/uchar.h>&lt;br /> Source/WebCore/platform/graphics/win/SimpleFontDataCGWin.cpp:#include &lt;unicode/unorm.h>&lt;br /> Source/WebCore/platform/graphics/blackberry/FontCacheBlackberry.cpp:#include &lt;unicode/utf16.h>&lt;br /> Source/WebCore/platform/graphics/blackberry/skia/PlatformSupport.cpp:#include &lt;unicode/utf16.h>&lt;br /> Source/WebCore/platform/graphics/freetype/SimpleFontDataFreeType.cpp:#include &lt;unicode/normlzr.h>&lt;br /> Source/WebCore/platform/graphics/harfbuzz/ComplexTextControllerHarfBuzz.cpp:#include &lt;unicode/normlzr.h>&lt;br /> Source/WebCore/platform/graphics/harfbuzz/ComplexTextControllerHarfBuzz.h:#include &lt;unicode/uchar.h>&lt;br /> Source/WebCore/platform/graphics/harfbuzz/HarfBuzzShaperBase.cpp:#include &lt;unicode/normlzr.h>&lt;br /> Source/WebCore/platform/graphics/harfbuzz/HarfBuzzShaperBase.cpp:#include &lt;unicode/uchar.h>&lt;br /> Source/WebCore/platform/graphics/harfbuzz/ng/HarfBuzzShaper.cpp:#include &lt;unicode/normlzr.h>&lt;br /> Source/WebCore/platform/graphics/harfbuzz/ng/HarfBuzzShaper.cpp:#include &lt;unicode/uchar.h>&lt;br /> Source/WebCore/platform/graphics/wx/SimpleFontDataWx.cpp:#include &lt;unicode/uchar.h>&lt;br /> Source/WebCore/platform/graphics/wx/SimpleFontDataWx.cpp:#include &lt;unicode/unorm.h>&lt;br /> Source/WebCore/platform/graphics/wx/GlyphMapWx.cpp:#include &lt;unicode/utf16.h>&lt;br /> Source/WebCore/platform/graphics/chromium/FontCacheChromiumWin.cpp:#include &lt;unicode/uniset.h>&lt;br /> Source/WebCore/platform/graphics/chromium/UniscribeHelper.h:#include &lt;unicode/uchar.h>&lt;br /> Source/WebCore/platform/graphics/chromium/FontUtilsChromiumWin.cpp:#include &lt;unicode/locid.h>&lt;br /> Source/WebCore/platform/graphics/chromium/FontUtilsChromiumWin.cpp:#include &lt;unicode/uchar.h>&lt;br /> Source/WebCore/platform/graphics/chromium/FontCacheAndroid.cpp:#include &lt;unicode/locid.h>&lt;br /> Source/WebCore/platform/graphics/chromium/SimpleFontDataChromiumWin.cpp:#include &lt;unicode/uchar.h>&lt;br /> Source/WebCore/platform/graphics/chromium/SimpleFontDataChromiumWin.cpp:#include &lt;unicode/unorm.h>&lt;br /> Source/WebCore/platform/graphics/chromium/FontUtilsChromiumWin.h:#include &lt;unicode/uscript.h>&lt;br /> Source/WebCore/platform/graphics/skia/SimpleFontDataSkia.cpp:#include &lt;unicode/normlzr.h>&lt;br /> Source/WebCore/platform/graphics/skia/FontCacheSkia.cpp:#include &lt;unicode/locid.h>&lt;br /> Source/WebCore/platform/text/TextEncoding.cpp:#include &lt;unicode/unorm.h>&lt;br /> Source/WebCore/platform/text/LocaleToScriptMappingICU.cpp:#include &lt;unicode/uloc.h>&lt;br /> Source/WebCore/platform/text/TextCodecICU.h:#include &lt;unicode/utypes.h>&lt;br /> Source/WebCore/platform/text/LocaleICU.h:#include &lt;unicode/udat.h>&lt;br /> Source/WebCore/platform/text/LocaleICU.h:#include &lt;unicode/unum.h>&lt;br /> Source/WebCore/platform/text/LineBreakIteratorPoolICU.h:#include &lt;unicode/ubrk.h>&lt;br /> Source/WebCore/platform/text/LocaleICU.cpp:#include &lt;unicode/udatpg.h>&lt;br /> Source/WebCore/platform/text/LocaleICU.cpp:#include &lt;unicode/uloc.h>&lt;br /> Source/WebCore/platform/text/TextCodecICU.cpp:#include &lt;unicode/ucnv.h>&lt;br /> Source/WebCore/platform/text/TextCodecICU.cpp:#include &lt;unicode/ucnv_cb.h>&lt;br /> Source/WebCore/platform/KURL.cpp:#include &lt;unicode/uidna.h>&lt;br /> Source/WebKit/blackberry/Api/WebPage.cpp:#include &lt;unicode/ustring.h> // platform &lt;span class="caps">ICU&lt;/span>&lt;br /> Source/WebKit/chromium/public/WebSettings.h:#include &lt;unicode/uscript.h>&lt;br /> Source/WebKit/chromium/src/linux/WebFontInfo.cpp:#include &lt;unicode/utf16.h>&lt;br /> Source/WTF/wtf/url/src/URLCanonICU.cpp:#include &lt;unicode/ucnv.h>&lt;br /> Source/WTF/wtf/url/src/URLCanonICU.cpp:#include &lt;unicode/ucnv_cb.h>&lt;br /> Source/WTF/wtf/url/src/URLCanonICU.cpp:#include &lt;unicode/uidna.h>&lt;br /> Source/WTF/wtf/unicode/icu/UnicodeIcu.h:#include &lt;unicode/uchar.h>&lt;br /> Source/WTF/wtf/unicode/icu/UnicodeIcu.h:#include &lt;unicode/uscript.h>&lt;br /> Source/WTF/wtf/unicode/icu/UnicodeIcu.h:#include &lt;unicode/ustring.h>&lt;br /> Source/WTF/wtf/unicode/icu/UnicodeIcu.h:#include &lt;unicode/utf16.h>&lt;br /> Source/WTF/wtf/unicode/icu/CollatorICU.cpp:#include &lt;unicode/ucol.h>&lt;br /> Source/WTF/wtf/unicode/qt4/UnicodeQt4.h:#include &lt;unicode/ubrk.h>

===Windows===

See http://thread.gmane.org/gmane.comp.lib.qt.devel/9226

&lt;span class="caps">ICU&lt;/span> is not shipped with Windows so all apps need to build and distribute their own copy of &lt;span class="caps">ICU&lt;/span> including data. Devs have complained that &lt;span class="caps">ICU&lt;/span> is too big (!) and too hard to build.

Binary downloads are available from &lt;span class="caps">ICU&lt;/span>, but only for mvsc10 and not debug versions which causes issues.

Work was started by Kai to determine what data resources were required and not required, but no results have been published.

Work required to determine if sufficient host api functionality available for system locale, and if locale resource bundles can be opened for custom locales.

For localization it seems unlikely the native &lt;span class="caps">API&lt;/span> will provide a sufficient solution so we need to make the build easier and the data smaller, or accept a lesser feature set for apps that don't wish to ship &lt;span class="caps">ICU&lt;/span>. This may not be an issue for most apps that don't require the more advanced locale features or custom locales. Those that do need the features will be more willing to make the effort.

===Mac===

&lt;span class="caps">ICU&lt;/span> ships as standard on &lt;span class="caps">OSX&lt;/span> and iOS, with the official &lt;span class="caps">API&lt;/span> classes effectively thin wrappers around &lt;span class="caps">ICU&lt;/span>. Shipped versions of &lt;span class="caps">ICU&lt;/span> tend to be rather old, and the headers are not included to discourage the direct use of &lt;span class="caps">ICU&lt;/span>. Currently to use &lt;span class="caps">ICU&lt;/span> on &lt;span class="caps">OSX&lt;/span> requires installing MacPorts and linking to their version of &lt;span class="caps">ICU&lt;/span>, but this is a bad solution as it is not portable or distributable (it also causes build problems if Macports Qt4 is also installed). It is possible to download the headers from opensource.apple.com with some effort and use those instead. However apps are rejected from the App Store if they directly link to &lt;span class="caps">ICU&lt;/span> which effectively rules out using the system &lt;span class="caps">ICU&lt;/span> for anything on iOS and thus for simplicity on &lt;span class="caps">OSX&lt;/span> too. It is not clear if shipping a self-built copy of &lt;span class="caps">ICU&lt;/span> is acceptable to the App Store, but the extra 20Mb added to the download is not likely to be acceptable to iOS developers so would need to be trimmed down.

&lt;span class="caps">ICU&lt;/span> provides a 64bit binary download of 11Mb.

For localization the native &lt;span class="caps">API&lt;/span> will probably be sufficient. Code tables require investigation. This leaves the issue of QtWebKit on iOS, need to find out what other WebKit users do, but they likely use the iOS version of WebKit.

===Linux===

&lt;span class="caps">ICU&lt;/span> is available on all distro's and likely to always be installed due to other projects depending on it so is not a problem for availability or download size. Distro's are used to the issues involved with using &lt;span class="caps">ICU&lt;/span> so it would not be unreasonable to make it a requirement to rebuild Qt whenever a major &lt;span class="caps">ICU&lt;/span> update is made. In fact, this seems to be existing policy for other packages using &lt;span class="caps">ICU&lt;/span>.

===Android===

Android ships &lt;span class="caps">ICU&lt;/span>. Needs more investigation on how it is used and if there are any problems with linking to it directly instead of the native &lt;span class="caps">API&lt;/span>.

===BB10 / &lt;span class="caps">QNX&lt;/span>===

&lt;span class="caps">QNX&lt;/span> ships &lt;span class="caps">ICU&lt;/span>. Needs more investigation on how it is used and if there are any problems with linking to it directly instead of the native &lt;span class="caps">API&lt;/span>.

==Possible solutions==

It seems clear we cannot rely on the system &lt;span class="caps">ICU&lt;/span> on Mac, and there is no system install on Windows, which swings the platform balance to 2 to 1 on devs having to build and ship &lt;span class="caps">ICU&lt;/span> themselves. While forcing a self-build is extra work for devs, it does have the benefit of allowing us to use the C++ api.

Practically, there are three options depending on what features we choose to use from &lt;span class="caps">ICU&lt;/span>:&lt;br /> 1) Only use &lt;span class="caps">ICU&lt;/span> on Linux for the host system localization, use the host api on Mac and Windows, and don't provide any advanced features that are not common to all three api's. The same would apply to Code Tables.&lt;br /> 2) Keep &lt;span class="caps">ICU&lt;/span> optional on Win/Mac, use Win/Mac host system api wherever possible and only require &lt;span class="caps">ICU&lt;/span> for optional advanced features when devs will be motivated to build and ship &lt;span class="caps">ICU&lt;/span>.&lt;br /> 3) Make &lt;span class="caps">ICU&lt;/span> a hard requirement to be built and shipped by all devs on Mac and Windows, and require Linux devs to either build and ship themselves or use the system install and always rebuild Qt on system &lt;span class="caps">ICU&lt;/span> upgrades.

Choosing 1) denies advanced features and doesn't solve the QtWebKit issue. In either of 2) or 3) devs will be faced with the need to build and ship &lt;span class="caps">ICU&lt;/span> themselves and we need to make this easy and lightweight for them. Shipping all of &lt;span class="caps">ICU&lt;/span> inside qtbase/3rdparty with a default config is not desirable, but nor can we expect all devs to suddenly become experts on building &lt;span class="caps">ICU&lt;/span>. We should provide a simple build script that configures and enables those features in &lt;span class="caps">ICU&lt;/span> that Qt uses, and allow the devs to choose what locales and code tables to ship.

One advantage of requiring our own copy of &lt;span class="caps">ICU&lt;/span> is we can set a minimum version that has all the features we want to use on all platforms, and can use the C++ &lt;span class="caps">API&lt;/span>.

===Localization===

The QTimeZone code provides a template for the solution. Keep the concept of a default system locale that uses the host facilities directly, but at compile time can determine if want to use &lt;span class="caps">ICU&lt;/span> instead. This means maintaining more code but seems the only practical solution.

On Linux: Use &lt;span class="caps">ICU&lt;/span> for system and custom locale.&lt;br /> On Mac: Use standard &lt;span class="caps">API&lt;/span> for system and custom locale.&lt;br /> On Windows: Work required to determine if sufficient functionality available for system locale, and if locale resource bundles can be opened for custom locales, otherwise will have to use &lt;span class="caps">ICU&lt;/span>.

===Data size / build===

A number of options are available to reduce the size of both the library and the data, by not building some features and reducing the data shipped for those features that are enabled.

The data can be built in 2 ways:&lt;br /> 1) The default is built as a shared data library that is linked to and loaded alongside the main &lt;span class="caps">ICU&lt;/span> library. This library is generated from a copy of the data files in the source tree. This is the fastest option but means the library must be updated if the data is to be updated, and is not portable across platforms.&lt;br /> 2) The shared data library is built as a stub and the data is loaded from a .dat file located in a defined directory. The .dat file is specific to a given major and minor release, but maintains BC for point releases and is portable across some platforms that have the same endianess.

Data is mmapped so memory usage is not affected by how much data is shipped.

Features can be disabled at build time by either editing the uconfig.h, uversion.h and utypes.h files, or more practically by passing -D flags.

Data resources that are not required can be removed to reduce the download size. This is done at build time by either directly modifying the original .mk files, or more practically by saving the modified options in new reslocal.mk files which will the &lt;span class="caps">ICU&lt;/span> build system will then use to override the original settings. Another option is to manually use the online data customiser to build a custom .dat file, but this is a manual interactive process not easily automated and may be prone to error.

Most data is the mapping conversion tables, removing these will have the greatest effect. &lt;span class="caps">ICU&lt;/span> notes "&lt;span class="caps">ICU&lt;/span> provides full internationalization functionality without any conversion table data. The common library contains code to handle several important encodings algorithmically: US-&lt;span class="caps">ASCII&lt;/span>, &lt;span class="caps">ISO&lt;/span>-8859-1, &lt;span class="caps">UTF&lt;/span>-7/8/16/32, &lt;span class="caps">SCSU&lt;/span>, &lt;span class="caps">BOCU&lt;/span>-1, &lt;span class="caps">CESU&lt;/span>-8, and &lt;span class="caps">IMAP&lt;/span>-mailbox-name (i.e., US-&lt;span class="caps">ASCII&lt;/span>, &lt;span class="caps">ISO&lt;/span>-8859-1, and all Unicode charsets; see source/data/mappings/convrtrs.txt for the current list)." As such even if Qt uses &lt;span class="caps">ICU&lt;/span> for conversions we may not need any of the conversion tables.

Locale data takes a small proportion, but may also be reduced by removing uncommon locales, or allowing devs to choose which they want.

Collation data uses a significant amount of data. Removing the Asian collation files would greatly reduce this but is probably undesirable. Another option is to remove the tailoring rule strings from which the data is built which are rarely used at runtime.

Proposal:&lt;br /> 1) Include a new build script in qtbase/3rdparty/icu&lt;br /> 2) Script is run as part of configure depending on platform and flags&lt;br /> 3) Script downloads the src tarball recommended for a given version of Qt&lt;br /> 4) Script defaults to building only those features used by Qt on a given platform and removes data resources that are not needed by most clients.&lt;br /> 5) Script can either be manually modified to include or excluded more features and data, or can interactively ask during configure step.&lt;br /> 6) Script writes modified data options to icu/src/data/*/reslocal.mk build files which override the main *.mk files&lt;br /> 7) Script runs configure with build-time options required&lt;br /> 8) Build happens as part of normal Qt build.

Suggested flags from &lt;span class="caps">ICU&lt;/span> readme:&lt;br /> U_USING_ICU_NAMESPACE=0&lt;br /> U_CHARSET_IS_UTF8=1 – On UTF8 platforms&lt;br />&lt;span class="caps">UNISTR&lt;/span>_FROM_CHAR_EXPLICIT=explicit&lt;br />&lt;span class="caps">UNISTR&lt;/span>_FROM_STRING_EXPLICIT=explicit&lt;br /> U_NO_DEFAULT_INCLUDE_UTF_HEADERS=1&lt;br /> U_HIDE_DRAFT_API&lt;br /> U_HIDE_INTERNAL_API&lt;br /> U_HIDE_SYSTEM_API&lt;br /> —with-library-suffix – Add Qt as a suffix to name

Other options available:&lt;br /> —with-data-packaging=archive – To use .dat file instead&lt;br /> —enable-static —disable-shared – For static builds

===QtWebKit===

Two options:&lt;br /> 1) Continue using &lt;span class="caps">ICU&lt;/span>, use new QtCore built copy of &lt;span class="caps">ICU&lt;/span>, assumes iOS will accept shipping extra copy of &lt;span class="caps">ICU&lt;/span>.&lt;br /> 2) Write new platform back-end using new Qt classes for locale and text layout, but this is a lot of work.

Option 1) is the only practical solution until such time as QtCore can provide all the required functions. The locale functions will come as a result of the new QLocale &lt;span class="caps">ICU&lt;/span> backend and wrapper classes, and as the design matches &lt;span class="caps">ICU&lt;/span> closely should be straightforward to implement. The difficulty of the text layout and encoding back-ends is an open question.

==&lt;span class="caps">ICU&lt;/span> Documentation==

http://site.icu-project.org/charts/charset&lt;br />http://site.icu-project.org/charts/icu4c-footprint&lt;br />http://userguide.icu-project.org/packaging&lt;br />http://userguide.icu-project.org/design&lt;br />http://userguide.icu-project.org/design#TOC-&lt;span class="caps">ICU&lt;/span>-Binary-Compatibility:-Using-&lt;span class="caps">ICU&lt;/span>-as-an-Operating-System-Level-Library&lt;br />http://userguide.icu-project.org/icudata&lt;br />http://apps.icu-project.org/datacustom/&lt;br />http://www.icu-project.org/docs/demo/datacustom_help.html&lt;br />http://source.icu-project.org/repos/icu/icu/trunk/readme.html
</textarea><div class="templatesUsed"><div class="mw-templatesUsedExplanation"><p>Templates used on this page:
</p></div><ul>
<li><a href="http://wiki.qt.io/Template:Ambox" title="Template:Ambox">Template:Ambox</a> (<a href="http://wiki.qt.io/index.php?title=Template:Ambox&amp;action=edit" title="Template:Ambox">view source</a>) </li><li><a href="http://wiki.qt.io/Template:Cleanup" title="Template:Cleanup">Template:Cleanup</a> (<a href="http://wiki.qt.io/index.php?title=Template:Cleanup&amp;action=edit" title="Template:Cleanup">view source</a>) </li></ul></div><p id="mw-returnto">Return to <a href="http://wiki.qt.io/Qt-contributors-summit-2013-18836" title="Qt-contributors-summit-2013-18836">Qt-contributors-summit-2013-18836</a>.</p>
</div>								<div class="printfooter">
				Retrieved from "<a href="http://wiki.qt.io/Qt-contributors-summit-2013-18836">http://wiki.qt.io/Qt-contributors-summit-2013-18836</a>"				</div>
												<div id='catlinks' class='catlinks catlinks-allhidden'></div>												<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>
			<div id="mw-head">
				<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
	<h3 id="p-personal-label">Personal tools</h3>
	<ul>
<li id="pt-anonuserpage"><a href="http://wiki.qt.io/User:10.0.113.70" class="new" title="The user page for the IP address you are editing as [.]" accesskey=".">10.0.113.70</a></li><li id="pt-anontalk"><a href="http://wiki.qt.io/User_talk:10.0.113.70" class="new" title="Discussion about edits from this IP address [n]" accesskey="n">Talk for this IP address</a></li><li id="pt-login"><a href="http://wiki.qt.io/index.php?title=Special:QtLogin&amp;returnto=Qt-contributors-summit-2013-18836" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Sign in</a></li>	</ul>
</div>
				<div id="left-navigation">
					<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
	<h3 id="p-namespaces-label">Namespaces</h3>
	<ul>
					<li  id="ca-nstab-main" class="selected"><span><a href="http://wiki.qt.io/Qt-contributors-summit-2013-18836"  title="View the content page [c]" accesskey="c">Page</a></span></li>
					<li  id="ca-talk" class="new"><span><a href="http://wiki.qt.io/index.php?title=Talk:Qt-contributors-summit-2013-18836&amp;action=edit&amp;redlink=1"  title="Discussion about the content page [t]" accesskey="t">Discussion</a></span></li>
			</ul>
</div>
<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
	<h3 id="mw-vector-current-variant">
		</h3>
	<h3 id="p-variants-label"><span>Variants</span><a href="#"></a></h3>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>
				</div>
				<div id="right-navigation">
					<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
	<h3 id="p-views-label">Views</h3>
	<ul>
					<li id="ca-view"><span><a href="http://wiki.qt.io/Qt-contributors-summit-2013-18836" >Read</a></span></li>
					<li id="ca-viewsource" class="selected"><span><a href="http://wiki.qt.io/index.php?title=Qt-contributors-summit-2013-18836&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
					<li id="ca-history" class="collapsible"><span><a href="http://wiki.qt.io/index.php?title=Qt-contributors-summit-2013-18836&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
			</ul>
</div>
<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
	<h3 id="p-cactions-label"><span>Actions</span><a href="#"></a></h3>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>
<div id="p-search" role="search">
	<h3><label for="searchInput">Search</label></h3>
	<form action="http://wiki.qt.io/index.php" id="searchform">
					<div id="simpleSearch">
					<input type="search" name="search" placeholder="Search" title="Search Qt Wiki [f]" accesskey="f" id="searchInput" /><input type="hidden" value="Special:Search" name="title" /><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton" /><input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchButton" class="searchButton" />		</div>
	</form>
</div>
				</div>
			</div>
			<div id="mw-panel">
					<div id="p-logo" role="banner"><a style="background-image: url(http://wiki.qt.io/skins/common/images/wiki.png);" href="http://wiki.qt.io/Main_Page"  title="Visit the main page"></a></div>
				<div class="portal" role="navigation" id='p-navigation' aria-labelledby='p-navigation-label'>
	<h3 id='p-navigation-label'>Navigation</h3>
	<div class="body">
		<ul>
			<li id="n-mainpage-description"><a href="http://wiki.qt.io/Main_Page" title="Visit the main page [z]" accesskey="z">Main page</a></li>
			<li id="n-recentchanges"><a href="http://wiki.qt.io/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
			<li id="n-randompage"><a href="http://wiki.qt.io/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
			<li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>
		</ul>
	</div>
</div>
<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
	<h3 id='p-tb-label'>Tools</h3>
	<div class="body">
		<ul>
			<li id="t-whatlinkshere"><a href="http://wiki.qt.io/Special:WhatLinksHere/Qt-contributors-summit-2013-18836" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
			<li id="t-recentchangeslinked"><a href="http://wiki.qt.io/Special:RecentChangesLinked/Qt-contributors-summit-2013-18836" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
			<li id="t-specialpages"><a href="http://wiki.qt.io/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
			<li id="t-info"><a href="http://wiki.qt.io/index.php?title=Qt-contributors-summit-2013-18836&amp;action=info">Page information</a></li>
		</ul>
	</div>
</div>
			</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-places">
											<li id="footer-places-terms"><a href='https://developer.qtcloudservices.com/legal/terms'>Käyttöehdot</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
					<li id="footer-poweredbyico">
						<a href="http://www.mediawiki.org/"><img src="http://wiki.qt.io/skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" width="88" height="31" /></a>
					</li>
				</ul>
						<div style="clear:both"></div>
		</div>
		<script>/*<![CDATA[*/window.jQuery && jQuery.ready();/*]]>*/</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.action.edit.collapsibleFooter","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","skins.vector.collapsibleNav"],null,true);
}</script>
<script src="http://wiki.qt.io/load.php?debug=false&amp;lang=en&amp;modules=site&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','http://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54043535-2', 'auto');
  ga('send', 'pageview');

</script>
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":173});
}</script>
	</body>

<!-- Mirrored from wiki.qt.io/index.php?title=Qt-contributors-summit-2013-18836&action=edit by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 05 Nov 2015 14:18:07 GMT -->
</html>
