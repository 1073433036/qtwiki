<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">

<!-- Mirrored from wiki.qt.io/index.php?title=Towers_lasers_and_spacecrafts_example&oldid=17080 by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 05 Nov 2015 12:10:40 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8" />
<title>Towers lasers and spacecrafts example - Qt Wiki</title>
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />
<meta name="generator" content="MediaWiki 1.23.3" />
<meta name="robots" content="noindex,nofollow" />
<link rel="shortcut icon" href="http://wiki.qt.io/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="http://wiki.qt.io/opensearch_desc.php" title="Qt Wiki (en)" />
<link rel="EditURI" type="application/rsd+xml" href="http://wiki.qt.io/api.php?action=rsd" />
<link rel="alternate" type="application/atom+xml" title="Qt Wiki Atom feed" href="http://wiki.qt.io/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="http://wiki.qt.io/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.skinning.interface%7Cmediawiki.ui.button%7Cskins.vector.styles&amp;only=styles&amp;skin=vector&amp;*" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="http://wiki.qt.io/load.php?debug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=vector&amp;*" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: qtio_wiki:resourceloader:filter:minify-css:7:e91d7bc946738c8892a88ad5616a59ba */</style>
<script src="http://wiki.qt.io/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Towers_lasers_and_spacecrafts_example","wgTitle":"Towers lasers and spacecrafts example","wgCurRevisionId":17080,"wgRevisionId":17080,"wgArticleId":2070,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Articles needing cleanup","Learning::Demos and Examples"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Towers_lasers_and_spacecrafts_example","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"dialogs":true,"hidesig":true,"preview":true,"previewDialog":false,"publish":true}});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"editfont":"default","editondblclick":0,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":1,"extendwatchlist":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"imagesize":2,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nickname":"","norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"rcdays":7,"rclimit":50,"rows":25,"showhiddencats":0,"shownumberswatching":1,"showtoolbar":1,"skin":"vector","stubthreshold":0,"thumbsize":2,"underline":2,"uselivepreview":0,"usenewrc":0,"watchcreations":1,"watchdefault":1,"watchdeletion":0,"watchlistdays":3,"watchlisthideanons":0,"watchlisthidebots":0,"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"wllimit":250,
"useeditwarning":1,"prefershttps":1,"usebetatoolbar":1,"usebetatoolbar-cgd":1,"wikieditor-preview":1,"wikieditor-publish":1,"language":"en","variant-gan":"gan","variant-iu":"iu","variant-kk":"kk","variant-ku":"ku","variant-shi":"shi","variant-sr":"sr","variant-tg":"tg","variant-uz":"uz","variant-zh":"zh","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false,"searchNs500":false,"searchNs501":false,"searchNs700":false,"searchNs701":false,"variant":"en"});},{},{});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":false,"watchToken":false});},{},{});
/* cache key: qtio_wiki:resourceloader:filter:minify-js:7:9743cb8b8019d46de5946bfe6dfa04d7 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script>
<style type="text/css">/*<![CDATA[*/
.source-cpp-qt {line-height: normal;}
.source-cpp-qt li, .source-cpp-qt pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for cpp-qt
 * CSS class: source-cpp-qt, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.cpp-qt.source-cpp-qt .de1, .cpp-qt.source-cpp-qt .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;font-family: monospace, monospace;}
.cpp-qt.source-cpp-qt  {font-family:monospace;}
.cpp-qt.source-cpp-qt .imp {font-weight: bold; color: red;}
.cpp-qt.source-cpp-qt li, .cpp-qt.source-cpp-qt .li1 {font-weight: normal; vertical-align:top;}
.cpp-qt.source-cpp-qt .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.cpp-qt.source-cpp-qt .li2 {font-weight: bold; vertical-align:top;}
.cpp-qt.source-cpp-qt .kw1 {color: #000000; font-weight:bold;}
.cpp-qt.source-cpp-qt .kw2 {color: #0057AE;}
.cpp-qt.source-cpp-qt .kw3 {color: #2B74C7;}
.cpp-qt.source-cpp-qt .kw4 {color: #0057AE;}
.cpp-qt.source-cpp-qt .kw5 {color: #22aadd;}
.cpp-qt.source-cpp-qt .co1 {color: #888888;}
.cpp-qt.source-cpp-qt .co2 {color: #006E28;}
.cpp-qt.source-cpp-qt .coMULTI {color: #888888; font-style: italic;}
.cpp-qt.source-cpp-qt .es0 {color: #000099; font-weight: bold;}
.cpp-qt.source-cpp-qt .es1 {color: #000099; font-weight: bold;}
.cpp-qt.source-cpp-qt .es2 {color: #660099; font-weight: bold;}
.cpp-qt.source-cpp-qt .es3 {color: #660099; font-weight: bold;}
.cpp-qt.source-cpp-qt .es4 {color: #660099; font-weight: bold;}
.cpp-qt.source-cpp-qt .es5 {color: #006699; font-weight: bold;}
.cpp-qt.source-cpp-qt .br0 {color: #006E28;}
.cpp-qt.source-cpp-qt .sy0 {color: #006E28;}
.cpp-qt.source-cpp-qt .st0 {color: #BF0303;}
.cpp-qt.source-cpp-qt .nu0 {color: #B08000;}
.cpp-qt.source-cpp-qt .nu6 {color: #208080;}
.cpp-qt.source-cpp-qt .nu8 {color: #208080;}
.cpp-qt.source-cpp-qt .nu12 {color: #208080;}
.cpp-qt.source-cpp-qt .nu16 {color:#800080;}
.cpp-qt.source-cpp-qt .nu17 {color:#800080;}
.cpp-qt.source-cpp-qt .nu18 {color:#800080;}
.cpp-qt.source-cpp-qt .nu19 {color:#800080;}
.cpp-qt.source-cpp-qt .me1 {color: #2B74C7;}
.cpp-qt.source-cpp-qt .me2 {color: #2B74C7;}
.cpp-qt.source-cpp-qt .me3 {color: #2B74C7;}
.cpp-qt.source-cpp-qt .ln-xtra, .cpp-qt.source-cpp-qt li.ln-xtra, .cpp-qt.source-cpp-qt div.ln-xtra {background-color: #ffc;}
.cpp-qt.source-cpp-qt span.xtra { display:block; }

/*]]>*/
</style><!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/vector/csshover.min.htc")}</style><![endif]--></head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Towers_lasers_and_spacecrafts_example skin-vector action-view vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>
			<div id="mw-js-message" style="display:none;"></div>
						<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">Towers lasers and spacecrafts example</span></h1>
						<div id="bodyContent">
								<div id="siteSub">From Qt Wiki</div>
								<div id="contentSub"><div id="mw-revision-info">Revision as of 12:34, 24 May 2015 by <a href="http://wiki.qt.io/User:Wieland" title="User:Wieland" class="mw-userlink">Wieland</a>  <span class="mw-usertoollinks">(<a href="http://wiki.qt.io/User_talk:Wieland" title="User talk:Wieland">Talk</a> | <a href="http://wiki.qt.io/Special:Contributions/Wieland" title="Special:Contributions/Wieland">contribs</a>)</span></div><br />
				<div id="mw-revision-nav">(<a href="http://wiki.qt.io/index.php?title=Towers_lasers_and_spacecrafts_example&amp;diff=prev&amp;oldid=17080" title="Towers lasers and spacecrafts example">diff</a>) <a href="http://wiki.qt.io/index.php?title=Towers_lasers_and_spacecrafts_example&amp;direction=prev&amp;oldid=17080" title="Towers lasers and spacecrafts example">← Older revision</a> | Latest revision (diff) | Newer revision → (diff)</div></div>
												<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="#mw-navigation">navigation</a>, 					<a href="#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><table style="center; margin: -1px auto 0px;border: 1px solid rgb(127, 194, 66); border-left: 10px solid rgb(127, 194, 66); background:rgb(250,250,250); width:600px">

<tr>
<td style="padding: 0.25em 0.5em;"> <b>This article may require cleanup to meet the Qt Wiki's quality standards.</b> Reason: Auto-imported from ExpressionEngine.<br /><small>Please <b><a rel="nofollow" class="external text" href="http://wiki.qt.io/index.php?title=Towers_lasers_and_spacecrafts_example&amp;action=edit">improve this article</a></b> if you can. Remove the {{cleanup}} tag and add this page to <b><a href="http://wiki.qt.io/Updated_pages" title="Updated pages">Updated pages</a></b> list after it's clean.</small>
</td></tr></table>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Simple_example_of_game_scene_with_QGraphicsScene"><span class="tocnumber">1</span> <span class="toctext">Simple example of game scene with QGraphicsScene</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Overview"><span class="tocnumber">1.1</span> <span class="toctext">Overview</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Main.cpp"><span class="tocnumber">1.2</span> <span class="toctext">Main.cpp</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#The_Scene"><span class="tocnumber">1.3</span> <span class="toctext">The Scene</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Towers"><span class="tocnumber">1.4</span> <span class="toctext">Towers</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Mobile_units"><span class="tocnumber">1.5</span> <span class="toctext">Mobile units</span></a></li>
</ul>
</li>
</ul>
</div>

<h1><span class="mw-headline" id="Simple_example_of_game_scene_with_QGraphicsScene">Simple example of game scene with QGraphicsScene</span></h1>
<p>This simple example mostly shows how to deal with
</p>
<ul>
<li> QGraphicsScene::advance()
</li>
<li> QGraphicsItem::advance()
</li>
<li> QGraphicsItem::paint(…)
</li>
</ul>
<h2><span class="mw-headline" id="Overview">Overview</span></h2>
<p>The example contains three classes with following responsabilities
</p>
<ul>
<li> The scene is a QGraphicsScene 
<ul>
<li> Creates and deletes new items (towers and mobile units)
</li>
</ul>
</li>
<li> Towers
<ul>
<li> search for nearby units
</li>
<li> shoot them if any
</li>
</ul>
</li>
<li> Mobile units (fighters)
<ul>
<li> Move
</li>
<li> Explode and die
</li>
</ul>
</li>
</ul>
<p><a rel="nofollow" class="external text" href="http://www.youtube.com/watch?v=cofUk8BK7nE">View example on Youtube</a>
</p><p><br />
</p>
<h2><span class="mw-headline" id="Main.cpp">Main.cpp</span></h2>
<p>The main() method creates a scene and a QTimer.
The timer calls Scene::advance() every 0.01 sec.
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="cpp-qt source-cpp-qt"><pre class="de1"><span class="co2">#include &lt;QtGui&gt;</span>
<span class="co2">#include &quot;scene.h&quot;</span>
<span class="co2">#include &quot;simpletower.h&quot;</span>
&#160;
<span class="kw4">int</span> main<span class="br0">&#40;</span><span class="kw4">int</span> argc<span class="sy0">,</span> <span class="kw4">char</span> <span class="st0">''</span><span class="st0">'argv)
 {
 QApplication app(argc, argv);
 Scene scene;
 scene.setSceneRect(0,0,640,360);
 QGraphicsView view(&amp;scene);
 QTimer timer;
 QObject::connect(&amp;timer, SIGNAL (timeout()), &amp;scene, SLOT (advance()));
 view.show();
 timer.start(10);
 return app.exec();
 }</span></pre></div></div>
<p><br />
</p>
<h2><span class="mw-headline" id="The_Scene">The Scene</span></h2>
<ul>
<li> The scene constructor creates several towers
</li>
<li> Scene::advance()&#160;:
</li>
</ul>
<p><b> has a counter m_TicTacTimer</b>
'<b><i> every 20th ticTac, a new mobile unit is created with a random position, direction and speed.</i></b>
'<b><i> dead units are removed from the item list</i></b>
</p><p><b>scene.h</b>
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="cpp-qt source-cpp-qt"><pre class="de1"><span class="co2">#ifndef SCENE_H</span>
<span class="co2">#define SCENE_H</span>
&#160;
<span class="co2">#include &lt;QGraphicsScene&gt;</span>
&#160;
<span class="kw2">class</span> Scene <span class="sy0">:</span> <span class="kw2">public</span> <span class="kw5">QGraphicsScene</span>
<span class="br0">&#123;</span>
 <span class="kw2">Q_OBJECT</span>
<span class="kw2">public</span><span class="sy0">:</span>
 Scene<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw2">public</span> <span class="kw2">slots</span><span class="sy0">:</span>
 <span class="kw4">void</span> advance<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw2">private</span><span class="sy0">:</span>
 <span class="kw4">int</span> m_TicTacTime<span class="sy0">;</span>
<span class="br0">&#125;</span><span class="sy0">;</span>
&#160;
<span class="co2">#endif // SCENE_H</span></pre></div></div>
<p><b>scene.cpp</b>
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="cpp-qt source-cpp-qt"><pre class="de1"><span class="co2">#include &quot;scene.h&quot;</span>
<span class="co2">#include &quot;mobileunit.h&quot;</span>
<span class="co2">#include &quot;simpletower.h&quot;</span>
<span class="co2">#include&lt;QDebug&gt;</span>
&#160;
Scene<span class="sy0">::</span><span class="me2">Scene</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
 <span class="sy0">:</span> <span class="kw5">QGraphicsScene</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
 <span class="sy0">,</span> m_TicTacTime<span class="br0">&#40;</span><span class="nu0">0</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
 SimpleTower <span class="sy0">*</span> simpleTower <span class="sy0">=</span> <span class="kw1">new</span> SimpleTower<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
 simpleTower<span class="sy0">-&gt;</span><span class="me3">setPos</span><span class="br0">&#40;</span><span class="nu16">200.0</span><span class="sy0">,</span> <span class="nu16">100.0</span><span class="br0">&#41;</span><span class="sy0">;</span>
 addItem<span class="br0">&#40;</span>simpleTower<span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
simpleTower <span class="sy0">=</span> <span class="kw1">new</span> SimpleTower<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
 simpleTower<span class="sy0">-&gt;</span><span class="me3">setPos</span><span class="br0">&#40;</span><span class="nu16">200.0</span><span class="sy0">,</span> <span class="nu16">180.0</span><span class="br0">&#41;</span><span class="sy0">;</span>
 addItem<span class="br0">&#40;</span>simpleTower<span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
simpleTower <span class="sy0">=</span> <span class="kw1">new</span> SimpleTower<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
 simpleTower<span class="sy0">-&gt;</span><span class="me3">setPos</span><span class="br0">&#40;</span><span class="nu16">200.0</span><span class="sy0">,</span> <span class="nu16">260.0</span><span class="br0">&#41;</span><span class="sy0">;</span>
 addItem<span class="br0">&#40;</span>simpleTower<span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
simpleTower <span class="sy0">=</span> <span class="kw1">new</span> SimpleTower<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
 simpleTower<span class="sy0">-&gt;</span><span class="me3">setPos</span><span class="br0">&#40;</span><span class="nu16">250.0</span><span class="sy0">,</span> <span class="nu16">050.0</span><span class="br0">&#41;</span><span class="sy0">;</span>
 addItem<span class="br0">&#40;</span>simpleTower<span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
simpleTower <span class="sy0">=</span> <span class="kw1">new</span> SimpleTower<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
 simpleTower<span class="sy0">-&gt;</span><span class="me3">setPos</span><span class="br0">&#40;</span><span class="nu16">250.0</span><span class="sy0">,</span> <span class="nu16">310.0</span><span class="br0">&#41;</span><span class="sy0">;</span>
 addItem<span class="br0">&#40;</span>simpleTower<span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
simpleTower <span class="sy0">=</span> <span class="kw1">new</span> SimpleTower<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
 simpleTower<span class="sy0">-&gt;</span><span class="me3">setPos</span><span class="br0">&#40;</span><span class="nu16">300.0</span><span class="sy0">,</span> <span class="nu16">110.0</span><span class="br0">&#41;</span><span class="sy0">;</span>
 addItem<span class="br0">&#40;</span>simpleTower<span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
simpleTower <span class="sy0">=</span> <span class="kw1">new</span> SimpleTower<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
 simpleTower<span class="sy0">-&gt;</span><span class="me3">setPos</span><span class="br0">&#40;</span><span class="nu16">300.0</span><span class="sy0">,</span> <span class="nu16">250.0</span><span class="br0">&#41;</span><span class="sy0">;</span>
 addItem<span class="br0">&#40;</span>simpleTower<span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
simpleTower <span class="sy0">=</span> <span class="kw1">new</span> SimpleTower<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
 simpleTower<span class="sy0">-&gt;</span><span class="me3">setPos</span><span class="br0">&#40;</span><span class="nu16">350.0</span><span class="sy0">,</span> <span class="nu16">180.0</span><span class="br0">&#41;</span><span class="sy0">;</span>
 addItem<span class="br0">&#40;</span>simpleTower<span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
<span class="br0">&#125;</span>
&#160;
<span class="kw4">void</span> Scene<span class="sy0">::</span><span class="me2">advance</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
 m_TicTacTime<span class="sy0">+</span><span class="st0">''</span><span class="sy0">;</span>
&#160;
 <span class="co1">// delete killed objects</span>
 <span class="kw5">QGraphicsItem</span> <span class="st0">''</span><span class="st0">'item=NULL;
 MobileUnit'</span><span class="st0">''</span> unit<span class="sy0">=</span>NULL<span class="sy0">;</span>
 <span class="kw4">int</span> i<span class="sy0">=</span><span class="nu0">0</span><span class="sy0">;</span>
 <span class="kw1">while</span> <span class="br0">&#40;</span>i<span class="sy0">&lt;</span>items<span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">count</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
 <span class="br0">&#123;</span>
 item<span class="sy0">=</span>items<span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">at</span><span class="br0">&#40;</span>i<span class="br0">&#41;</span><span class="sy0">;</span>
 unit<span class="sy0">=</span><span class="kw2">dynamic_cast</span><span class="sy0">&lt;</span>MobileUnit<span class="sy0">*</span> <span class="sy0">&gt;</span> <span class="br0">&#40;</span>item<span class="br0">&#41;</span><span class="sy0">;</span>
 <span class="kw1">if</span> <span class="br0">&#40;</span> <span class="br0">&#40;</span> unit<span class="sy0">!=</span><span class="kw2">NULL</span><span class="br0">&#41;</span> <span class="sy0">&amp;&amp;</span> <span class="br0">&#40;</span>unit<span class="sy0">-&gt;</span><span class="me3">isFinished</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">==</span><span class="kw2">true</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
 <span class="br0">&#123;</span>
 removeItem<span class="br0">&#40;</span>item<span class="br0">&#41;</span><span class="sy0">;</span>
 <span class="kw1">delete</span> unit<span class="sy0">;</span>
 <span class="br0">&#125;</span>
 elsei<span class="sy0">;</span>
 <span class="br0">&#125;</span>
&#160;
 <span class="co1">// Add new units every 20 tictacs</span>
 <span class="kw1">if</span><span class="br0">&#40;</span>m_TicTacTime <span class="sy0">%</span> <span class="nu0">20</span><span class="sy0">==</span><span class="nu0">0</span><span class="br0">&#41;</span>
 <span class="br0">&#123;</span>
 <span class="co1">// qDebug() &lt;&lt; &quot;add unit&quot;;</span>
 MobileUnit <span class="sy0">*</span> mobileUnit<span class="sy0">=</span> <span class="kw1">new</span> MobileUnit<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
 qreal h<span class="sy0">=</span><span class="kw2">static_cast</span><span class="sy0">&lt;</span>qreal<span class="sy0">&gt;</span><span class="br0">&#40;</span> qrand<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">%</span> <span class="kw2">static_cast</span><span class="sy0">&lt;</span><span class="kw4">int</span><span class="sy0">&gt;</span><span class="br0">&#40;</span>height<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#41;</span><span class="sy0">;</span>
 mobileUnit<span class="sy0">-&gt;</span><span class="me3">setPos</span><span class="br0">&#40;</span>width<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span> h<span class="br0">&#41;</span><span class="sy0">;</span>
 addItem<span class="br0">&#40;</span>mobileUnit<span class="br0">&#41;</span><span class="sy0">;</span>
 <span class="br0">&#125;</span>
&#160;
 <span class="kw5">QGraphicsScene</span><span class="sy0">::</span><span class="me2">advance</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
 update<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre></div></div>
<h2><span class="mw-headline" id="Towers">Towers</span></h2>
<ul>
<li> Towers search for nearby units
</li>
</ul>
<p>'<b><i> Search is performed by squared distance comparison</i></b>
'<b><i> Search stops when a first item is found</i></b>
'<b><i> Warning: n against n = O (n2) algorithm… Poor performances on large amount of items… but sufficient here.</i></b>
</p>
<ul>
<li> Towers shoot the located item if any
</li>
<li> after shooting, a tower must wait until its weapon is reloaded&#160;: it requires a "reload time" of 100ms
</li>
<li> The laser beam is drawn with lines of different thicknesses and colors
</li>
</ul>
<p><b>simpletower.h</b>
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="cpp-qt source-cpp-qt"><pre class="de1"><span class="co2">#ifndef SIMPLETOWER_H</span>
<span class="co2">#define SIMPLETOWER_H</span>
&#160;
<span class="co2">#include &lt;QtCore&gt;</span>
<span class="co2">#include &lt;QGraphicsRectItem&gt;</span>
&#160;
<span class="kw2">class</span> MobileUnit<span class="sy0">;</span>
&#160;
<span class="kw2">class</span> SimpleTower <span class="sy0">:</span> <span class="kw2">public</span> <span class="kw5">QGraphicsRectItem</span>
<span class="br0">&#123;</span>
<span class="kw2">public</span><span class="sy0">:</span>
 SimpleTower<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
 <span class="kw4">void</span> paint<span class="br0">&#40;</span><span class="kw5">QPainter</span> <span class="sy0">*</span>painter<span class="sy0">,</span> <span class="kw4">const</span> <span class="kw5">QStyleOptionGraphicsItem</span> <span class="sy0">*</span>option<span class="sy0">,</span> <span class="kw5">QWidget</span> <span class="st0">''</span><span class="st0">'widget);
 void advance(int phase);
private:
 void searchTarget();
 void shoot();
private:
 qreal m_DetectionDistance;
 QTime m_Time;
 int m_ReloadTime;
 bool m_ShootIsActive;
 MobileUnit'</span><span class="st0">''</span> m_Target<span class="sy0">;</span>
 <span class="kw5">QImage</span> m_TowerImage<span class="sy0">;</span>
<span class="br0">&#125;</span><span class="sy0">;</span>
&#160;
<span class="co2">#endif // SIMPLETOWER_H</span></pre></div></div>
<p><b>simpletower.cpp</b>
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="cpp-qt source-cpp-qt"><pre class="de1"><span class="co2">#include &lt;QPainter&gt;</span>
<span class="co2">#include &lt;QGraphicsScene&gt;</span>
<span class="co2">#include &quot;simpletower.h&quot;</span>
<span class="co2">#include &quot;mobileunit.h&quot;</span>
SimpleTower<span class="sy0">::</span><span class="me2">SimpleTower</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
 <span class="sy0">:</span> <span class="kw5">QGraphicsRectItem</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
 <span class="sy0">,</span> m_DetectionDistance<span class="br0">&#40;</span><span class="nu16">100.0</span><span class="br0">&#41;</span>
 <span class="sy0">,</span> m_Time<span class="br0">&#40;</span><span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="br0">&#41;</span>
 <span class="sy0">,</span> m_ReloadTime<span class="br0">&#40;</span><span class="nu0">100</span><span class="br0">&#41;</span>
 <span class="sy0">,</span> m_ShootIsActive<span class="br0">&#40;</span><span class="kw2">false</span><span class="br0">&#41;</span>
 <span class="sy0">,</span> m_Target<span class="br0">&#40;</span><span class="kw2">NULL</span><span class="br0">&#41;</span>
 <span class="sy0">,</span> m_TowerImage<span class="br0">&#40;</span><span class="kw5">QImage</span><span class="br0">&#40;</span><span class="st0">&quot;:/lightTower&quot;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
 setRect<span class="br0">&#40;</span>–<span class="nu16">15.0</span><span class="sy0">,</span> <span class="sy0">-</span><span class="nu16">15.0</span><span class="sy0">,</span> <span class="nu16">30.0</span><span class="sy0">,</span> <span class="nu16">30.0</span><span class="br0">&#41;</span><span class="sy0">;</span>
 m_Time.<span class="me1">start</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
&#160;
<span class="kw4">void</span> SimpleTower<span class="sy0">::</span><span class="me2">paint</span><span class="br0">&#40;</span><span class="kw5">QPainter</span> <span class="sy0">*</span>painter<span class="sy0">,</span> <span class="kw4">const</span> <span class="kw5">QStyleOptionGraphicsItem</span> <span class="sy0">*</span>option<span class="sy0">,</span> <span class="kw5">QWidget</span> <span class="st0">''</span><span class="st0">'widget)
{
 painter-&gt;drawImage(–15,-15,m_TowerImage);
 if ( (m_Target!=NULL) &amp;&amp; (m_ShootIsActive) )
 { // laser beam
 QPointF towerPoint = mapFromScene(pos());
 QPointF target = mapFromScene(m_Target-&gt;pos());
 painter-&gt;setPen(QPen(Qt::yellow,8.0,Qt::SolidLine));
 painter-&gt;drawLine(towerPoint.x(), towerPoint.y(), target.x(), target.y());
 painter-&gt;setPen(QPen(Qt::red,5.0,Qt::SolidLine));
 painter-&gt;drawLine(towerPoint.x(), towerPoint.y(), target.x(), target.y());
 painter-&gt;setPen(QPen(Qt::white,2.0,Qt::SolidLine));
 painter-&gt;drawLine(towerPoint.x(), towerPoint.y(), target.x(), target.y());
 m_ShootIsActive=false;
 }
}
&#160;
void SimpleTower::advance(int phase)
{
 if (phase==0)
 {
 searchTarget();
 if ( (m_Target!=NULL) &amp;&amp; (m_Time.elapsed()&gt; m_ReloadTime) )
 shoot();
 }
}
&#160;
void SimpleTower::searchTarget()
{
 m_Target=NULL;
 QList&lt;QGraphicsItem'</span><span class="st0">''</span> <span class="sy0">&gt;</span> itemList <span class="sy0">=</span> scene<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">-&gt;</span><span class="me3">items</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
 <span class="kw4">int</span> i <span class="sy0">=</span> itemList.<span class="me1">count</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">-</span><span class="nu0">1</span><span class="sy0">;</span>
 qreal dx<span class="sy0">,</span> dy<span class="sy0">,</span> sqrDist<span class="sy0">;</span>
 qreal sqrDetectionDist <span class="sy0">=</span> m_DetectionDistance <span class="sy0">*</span> m_DetectionDistance<span class="sy0">;</span>
 MobileUnit <span class="sy0">*</span> unit<span class="sy0">=</span>NULL<span class="sy0">;</span>
 <span class="kw1">while</span><span class="br0">&#40;</span> <span class="br0">&#40;</span>i<span class="sy0">&gt;=</span><span class="nu0">0</span><span class="br0">&#41;</span> <span class="sy0">&amp;&amp;</span> <span class="br0">&#40;</span><span class="kw2">NULL</span><span class="sy0">==</span>m_Target<span class="br0">&#41;</span> <span class="br0">&#41;</span>
 <span class="br0">&#123;</span>
 <span class="kw5">QGraphicsItem</span> <span class="sy0">*</span> item <span class="sy0">=</span> itemList.<span class="me1">at</span><span class="br0">&#40;</span>i<span class="br0">&#41;</span><span class="sy0">;</span>
 unit <span class="sy0">=</span> <span class="kw2">dynamic_cast</span><span class="sy0">&lt;</span>MobileUnit <span class="sy0">*</span> <span class="sy0">&gt;</span><span class="br0">&#40;</span>item<span class="br0">&#41;</span><span class="sy0">;</span>
 <span class="kw1">if</span> <span class="br0">&#40;</span> <span class="br0">&#40;</span>unit<span class="sy0">!=</span><span class="kw2">NULL</span><span class="br0">&#41;</span> <span class="sy0">&amp;&amp;</span> <span class="br0">&#40;</span> unit<span class="sy0">-&gt;</span><span class="me3">lifePoints</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">&gt;</span><span class="nu0">0</span> <span class="br0">&#41;</span> <span class="br0">&#41;</span>
 <span class="br0">&#123;</span>
 dx <span class="sy0">=</span> unit<span class="sy0">-&gt;</span><span class="me3">x</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">-</span>x<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
 dy <span class="sy0">=</span> unit<span class="sy0">-&gt;</span><span class="me3">y</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">-</span>y<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
 sqrDist <span class="sy0">=</span> dx<span class="sy0">*</span>dx<span class="sy0">+</span>dy<span class="sy0">*</span>dy<span class="sy0">;</span>
 <span class="kw1">if</span> <span class="br0">&#40;</span>sqrDist <span class="sy0">&lt;</span> sqrDetectionDist<span class="br0">&#41;</span>
 m_Target<span class="sy0">=</span>unit<span class="sy0">;</span>
 <span class="br0">&#125;</span>
 —i<span class="sy0">;</span>
 <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&#160;
<span class="kw4">void</span> SimpleTower<span class="sy0">::</span><span class="me2">shoot</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
 m_ShootIsActive<span class="sy0">=</span>true<span class="sy0">;</span>
 m_Target<span class="sy0">-&gt;</span><span class="me3">touched</span><span class="br0">&#40;</span><span class="nu0">3</span><span class="br0">&#41;</span><span class="sy0">;</span>
 m_Time.<span class="me1">restart</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre></div></div>
<h2><span class="mw-headline" id="Mobile_units">Mobile units</span></h2>
<p>Life Cycle of a mobile unit&#160;:
</p>
<ul>
<li> A mobile unit is created with 10 life points
</li>
<li> Position changes according to predefined direction and speed
</li>
<li> It loses life points if touched by a laser beam
</li>
<li> The unit explodes when lifepoints are exhausted
</li>
<li> The explosion has a duration.
</li>
<li> The explosion is drawn by painter-&gt;drawEllipse(…) with a growing radius
</li>
</ul>
<p><b>mobileunit.h</b>
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="cpp-qt source-cpp-qt"><pre class="de1"><span class="co2">#ifndef MOBILEUNIT_H</span>
<span class="co2">#define MOBILEUNIT_H</span>
&#160;
<span class="co2">#include &lt;QtCore&gt;</span>
<span class="co2">#include &lt;QGraphicsRectItem&gt;</span>
<span class="co2">#include &lt;QRadialGradient&gt;</span>
&#160;
<span class="kw2">class</span> MobileUnit <span class="sy0">:</span> <span class="kw2">public</span> <span class="kw5">QGraphicsRectItem</span>
<span class="br0">&#123;</span>
<span class="kw2">public</span><span class="sy0">:</span>
 MobileUnit<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
 <span class="kw2">inline</span> <span class="kw4">int</span> lifePoints<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="kw1">return</span> m_LifePoints<span class="sy0">;</span> <span class="br0">&#125;</span>
 <span class="kw2">inline</span> <span class="kw4">bool</span> isFinished<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="kw4">const</span> <span class="br0">&#123;</span> <span class="kw1">return</span> m_IsFinished<span class="sy0">;</span> <span class="br0">&#125;</span>
 <span class="kw4">void</span> paint<span class="br0">&#40;</span><span class="kw5">QPainter</span> <span class="sy0">*</span>painter<span class="sy0">,</span> <span class="kw4">const</span> <span class="kw5">QStyleOptionGraphicsItem</span> <span class="sy0">*</span>option<span class="sy0">,</span> <span class="kw5">QWidget</span> <span class="sy0">*</span>widget<span class="br0">&#41;</span><span class="sy0">;</span>
 <span class="kw4">void</span> advance<span class="br0">&#40;</span><span class="kw4">int</span> phase<span class="br0">&#41;</span><span class="sy0">;</span>
 <span class="kw4">void</span> touched <span class="br0">&#40;</span><span class="kw4">int</span> hurtPoints<span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw2">private</span><span class="sy0">:</span>
 <span class="kw4">int</span> m_LifePoints<span class="sy0">;</span>
 qreal m_Alpha<span class="sy0">;</span>
 qreal m_DirX<span class="sy0">;</span>
 qreal m_DirY<span class="sy0">;</span>
 qreal m_Speed<span class="sy0">;</span>
 <span class="kw4">bool</span> m_IsFinished<span class="sy0">;</span>
 <span class="kw4">bool</span> m_IsExploding<span class="sy0">;</span>
 <span class="kw4">int</span> m_ExplosionDuration<span class="sy0">;</span>
 <span class="kw5">QRadialGradient</span> m_RedExplosion<span class="sy0">;</span>
 <span class="kw5">QTime</span> m_Time<span class="sy0">;</span>
 <span class="kw5">QImage</span> m_SpacecraftImage<span class="sy0">;</span>
<span class="br0">&#125;</span><span class="sy0">;</span>
&#160;
<span class="co2">#endif // MOBILEUNIT_H</span></pre></div></div>
<p><b>mobileunit.cpp</b>
</p><p><br />
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="cpp-qt source-cpp-qt"><pre class="de1"><span class="co2">#include &quot;mobileunit.h&quot;</span>
<span class="co2">#include &lt;QPainter&gt;</span>
<span class="co2">#include &lt;QGraphicsScene&gt;</span>
<span class="co2">#include &lt;math.h&gt;</span>
&#160;
MobileUnit<span class="sy0">::</span><span class="me2">MobileUnit</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
 <span class="sy0">:</span> <span class="kw5">QGraphicsRectItem</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
 <span class="sy0">,</span> m_LifePoints<span class="br0">&#40;</span><span class="nu0">10</span><span class="br0">&#41;</span>
 <span class="sy0">,</span> m_Alpha<span class="br0">&#40;</span><span class="nu0">0</span><span class="br0">&#41;</span>
 <span class="sy0">,</span> m_DirX<span class="br0">&#40;</span><span class="nu16">1.0</span><span class="br0">&#41;</span>
 <span class="sy0">,</span> m_DirY<span class="br0">&#40;</span><span class="nu16">0.0</span><span class="br0">&#41;</span>
 <span class="sy0">,</span> m_Speed<span class="br0">&#40;</span><span class="nu16">1.0</span><span class="br0">&#41;</span>
 <span class="sy0">,</span> m_IsFinished<span class="br0">&#40;</span><span class="kw2">false</span><span class="br0">&#41;</span>
 <span class="sy0">,</span> m_IsExploding<span class="br0">&#40;</span><span class="kw2">false</span><span class="br0">&#41;</span>
 <span class="sy0">,</span> m_ExplosionDuration<span class="br0">&#40;</span><span class="nu0">500</span><span class="br0">&#41;</span>
 <span class="sy0">,</span> m_RedExplosion<span class="br0">&#40;</span><span class="nu16">0.0</span><span class="sy0">,</span> <span class="nu16">0.0</span><span class="sy0">,</span> <span class="nu16">20.0</span><span class="sy0">,</span> <span class="nu16">0.0</span><span class="sy0">,</span> <span class="nu16">0.0</span><span class="br0">&#41;</span>
 <span class="sy0">,</span> m_Time<span class="br0">&#40;</span><span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="br0">&#41;</span>
 <span class="sy0">,</span> m_SpacecraftImage<span class="br0">&#40;</span><span class="kw5">QImage</span><span class="br0">&#40;</span><span class="st0">&quot;:/spacecraft00&quot;</span><span class="br0">&#41;</span> <span class="br0">&#41;</span>
<span class="br0">&#123;</span>
 m_Alpha<span class="sy0">=</span> <span class="kw2">static_cast</span><span class="sy0">&lt;</span>qreal<span class="sy0">&gt;</span> <span class="br0">&#40;</span>qrand<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">%</span><span class="nu19">90</span><span class="sy0">+</span><span class="nu0">60</span><span class="br0">&#41;</span><span class="sy0">;</span>
 qreal speed<span class="sy0">=</span> <span class="kw2">static_cast</span><span class="sy0">&lt;</span>qreal<span class="sy0">&gt;</span> <span class="br0">&#40;</span>qrand<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">%</span><span class="nu19">10</span><span class="sy0">-</span><span class="nu0">5</span><span class="br0">&#41;</span><span class="sy0">;</span>
 m_DirY<span class="sy0">=</span><span class="kw3">cos</span><span class="br0">&#40;</span>m_Alpha<span class="sy0">/</span><span class="nu16">180.0</span><span class="sy0">*</span>M_PI <span class="br0">&#41;</span><span class="sy0">;</span>
 m_DirX<span class="sy0">=</span><span class="kw3">sin</span><span class="br0">&#40;</span>m_Alpha<span class="sy0">/</span><span class="nu16">180.0</span><span class="sy0">*</span>M_PI<span class="br0">&#41;</span><span class="sy0">;</span>
 m_Alpha<span class="sy0">=</span> <span class="sy0">-</span>m_Alpha<span class="st0">''</span> <span class="nu16">180.0</span> <span class="sy0">;</span>
 m_Speed<span class="sy0">=</span><span class="nu16">1.0</span><span class="sy0">+</span>speed<span class="sy0">*</span><span class="nu16">0.1</span><span class="sy0">;</span>
 setRect<span class="br0">&#40;</span>–<span class="nu16">10.0</span><span class="sy0">,</span> <span class="sy0">-</span><span class="nu16">10.0</span><span class="sy0">,</span> <span class="nu16">20.0</span><span class="sy0">,</span> <span class="nu16">20.0</span><span class="br0">&#41;</span><span class="sy0">;</span>
 m_Time.<span class="me1">start</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
 m_RedExplosion.<span class="me1">setColorAt</span><span class="br0">&#40;</span><span class="nu16">0.0</span><span class="sy0">,</span> <span class="kw5">Qt</span><span class="sy0">::</span><span class="me2">white</span><span class="br0">&#41;</span><span class="sy0">;</span>
 m_RedExplosion.<span class="me1">setColorAt</span><span class="br0">&#40;</span><span class="nu16">0.2</span><span class="sy0">,</span> <span class="kw5">QColor</span><span class="br0">&#40;</span><span class="nu0">255</span><span class="sy0">,</span> <span class="nu0">255</span><span class="sy0">,</span> <span class="nu0">100</span><span class="sy0">,</span> <span class="nu0">255</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
 m_RedExplosion.<span class="me1">setColorAt</span><span class="br0">&#40;</span><span class="nu16">0.4</span><span class="sy0">,</span> <span class="kw5">QColor</span><span class="br0">&#40;</span><span class="nu0">255</span><span class="sy0">,</span> <span class="nu0">80</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">200</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
 m_RedExplosion.<span class="me1">setColorAt</span><span class="br0">&#40;</span><span class="nu16">1.0</span><span class="sy0">,</span> <span class="kw5">QColor</span><span class="br0">&#40;</span><span class="nu0">255</span><span class="sy0">,</span> <span class="nu0">255</span><span class="sy0">,</span> <span class="nu0">255</span><span class="sy0">,</span> <span class="nu0">0</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
&#160;
<span class="kw4">void</span> MobileUnit<span class="sy0">::</span><span class="me2">paint</span><span class="br0">&#40;</span><span class="kw5">QPainter</span> <span class="sy0">*</span>painter<span class="sy0">,</span> <span class="kw4">const</span> <span class="kw5">QStyleOptionGraphicsItem</span> <span class="sy0">*</span>option<span class="sy0">,</span> <span class="kw5">QWidget</span> <span class="sy0">*</span>widget<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
 painter<span class="sy0">-&gt;</span><span class="me3">setPen</span><span class="br0">&#40;</span><span class="kw5">Qt</span><span class="sy0">::</span><span class="me2">NoPen</span><span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
<span class="kw1">if</span> <span class="br0">&#40;</span><span class="sy0">!</span>m_IsExploding<span class="br0">&#41;</span>
 <span class="br0">&#123;</span>
 painter<span class="sy0">-&gt;</span><span class="me3">rotate</span><span class="br0">&#40;</span>m_Alpha<span class="br0">&#41;</span><span class="sy0">;</span>
 painter<span class="sy0">-&gt;</span><span class="me3">drawImage</span><span class="br0">&#40;</span>–<span class="nu0">15</span><span class="sy0">,-</span><span class="nu0">14</span><span class="sy0">,</span> m_SpacecraftImage<span class="br0">&#41;</span><span class="sy0">;</span>
 <span class="br0">&#125;</span>
 <span class="kw1">else</span>
 <span class="br0">&#123;</span>
 painter<span class="sy0">-&gt;</span><span class="me3">setBrush</span><span class="br0">&#40;</span><span class="kw5">QBrush</span><span class="br0">&#40;</span>m_RedExplosion<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
 qreal explosionRadius<span class="sy0">=</span> <span class="nu16">8.0</span> <span class="sy0">+</span> m_Time.<span class="me1">elapsed</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">/</span> <span class="nu0">50</span><span class="sy0">;</span>
 painter<span class="sy0">-&gt;</span><span class="me3">drawEllipse</span><span class="br0">&#40;</span><span class="sy0">-</span>explosionRadius<span class="sy0">,</span> <span class="sy0">-</span>explosionRadius<span class="sy0">,</span> <span class="nu16">2.0</span><span class="sy0">*</span>explosionRadius<span class="sy0">,</span> <span class="nu16">2.0</span><span class="sy0">*</span>explosionRadius<span class="br0">&#41;</span><span class="sy0">;</span>
 <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&#160;
<span class="kw4">void</span> MobileUnit<span class="sy0">::</span><span class="me2">advance</span><span class="br0">&#40;</span><span class="kw4">int</span> phase<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
 <span class="kw1">if</span> <span class="br0">&#40;</span>phase<span class="sy0">==</span><span class="nu0">0</span><span class="br0">&#41;</span>
 <span class="br0">&#123;</span>
 qreal xx<span class="sy0">=</span>x<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span> qreal yy<span class="sy0">=</span>y<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
 <span class="kw1">if</span> <span class="br0">&#40;</span> <span class="br0">&#40;</span>xx<span class="sy0">&lt;</span><span class="nu16">0.0</span><span class="br0">&#41;</span> <span class="sy0">||</span> <span class="br0">&#40;</span>xx <span class="sy0">&gt;</span> scene<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">-&gt;</span><span class="me3">width</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#41;</span> <span class="br0">&#41;</span>
 <span class="br0">&#123;</span> <span class="co1">// rebond</span>
 m_DirX<span class="sy0">=-</span>m_DirX<span class="sy0">;</span>
 m_Alpha<span class="sy0">=-</span>m_Alpha<span class="sy0">;</span>
 <span class="br0">&#125;</span>
 <span class="kw1">if</span> <span class="br0">&#40;</span> <span class="br0">&#40;</span>yy<span class="sy0">&lt;</span><span class="nu16">0.0</span><span class="br0">&#41;</span> <span class="sy0">||</span> <span class="br0">&#40;</span>yy <span class="sy0">&gt;</span> scene<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">-&gt;</span><span class="me3">height</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
 <span class="br0">&#123;</span> <span class="co1">// rebond</span>
 m_DirY<span class="sy0">=-</span>m_DirY<span class="sy0">;</span>
 m_Alpha<span class="sy0">=</span><span class="nu0">180</span><span class="sy0">-</span>m_Alpha<span class="sy0">;</span>
 <span class="br0">&#125;</span>
 <span class="kw1">if</span> <span class="br0">&#40;</span>m_IsExploding<span class="br0">&#41;</span>
 <span class="br0">&#123;</span>
 m_Speed<span class="sy0">*=</span><span class="nu16">0.98</span><span class="sy0">;</span> <span class="co1">// decrease speed</span>
 <span class="kw1">if</span> <span class="br0">&#40;</span>m_Time.<span class="me1">elapsed</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">&gt;</span> m_ExplosionDuration<span class="br0">&#41;</span>
 m_IsFinished<span class="sy0">=</span>true<span class="sy0">;</span> <span class="co1">// is dead</span>
 <span class="br0">&#125;</span>
 setPos<span class="br0">&#40;</span>x<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">+</span>m_DirX<span class="sy0">*</span>m_Speed<span class="sy0">,</span> y<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">+</span>m_DirY<span class="sy0">*</span>m_Speed<span class="br0">&#41;</span><span class="sy0">;</span>
 <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&#160;
<span class="kw4">void</span> MobileUnit<span class="sy0">::</span><span class="me2">touched</span> <span class="br0">&#40;</span><span class="kw4">int</span> hurtPoints<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
 m_LifePoints<span class="sy0">-=</span>hurtPoints<span class="sy0">;</span> <span class="co1">// decrease life</span>
 <span class="kw1">if</span> <span class="br0">&#40;</span>m_LifePoints<span class="sy0">&lt;</span><span class="nu0">0</span><span class="br0">&#41;</span> m_LifePoints<span class="sy0">=</span><span class="nu0">0</span><span class="sy0">;</span>
 <span class="kw1">if</span> <span class="br0">&#40;</span>m_LifePoints<span class="sy0">==</span><span class="nu0">0</span><span class="br0">&#41;</span>
 <span class="br0">&#123;</span>
 m_Time.<span class="me1">start</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
 m_IsExploding<span class="sy0">=</span>true<span class="sy0">;</span>
 <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre></div></div>

<!-- 
NewPP limit report
CPU time usage: 0.148 seconds
Real time usage: 0.149 seconds
Preprocessor visited node count: 92/1000000
Preprocessor generated node count: 240/1000000
Post‐expand include size: 1356/2097152 bytes
Template argument size: 434/2097152 bytes
Highest expansion depth: 5/40
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key qtio_wiki:pcache:idhash:2070-0!*!0!!en!*!* and timestamp 20151105100342 and revision id 17080
 -->
</div>								<div class="printfooter">
				Retrieved from "<a href="http://wiki.qt.io/index.php?title=Towers_lasers_and_spacecrafts_example&amp;oldid=17080">http://wiki.qt.io/index.php?title=Towers_lasers_and_spacecrafts_example&amp;oldid=17080</a>"				</div>
												<div id='catlinks' class='catlinks'><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="http://wiki.qt.io/Special:Categories" title="Special:Categories">Categories</a>: <ul><li><a href="http://wiki.qt.io/Category:Articles_needing_cleanup" title="Category:Articles needing cleanup">Articles needing cleanup</a></li><li><a href="http://wiki.qt.io/Category:Learning::Demos_and_Examples" title="Category:Learning::Demos and Examples">Learning::Demos and Examples</a></li></ul></div></div>												<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>
			<div id="mw-head">
				<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
	<h3 id="p-personal-label">Personal tools</h3>
	<ul>
<li id="pt-anonuserpage"><a href="http://wiki.qt.io/User:10.0.113.70" class="new" title="The user page for the IP address you are editing as [.]" accesskey=".">10.0.113.70</a></li><li id="pt-anontalk"><a href="http://wiki.qt.io/User_talk:10.0.113.70" class="new" title="Discussion about edits from this IP address [n]" accesskey="n">Talk for this IP address</a></li><li id="pt-login"><a href="http://wiki.qt.io/index.php?title=Special:QtLogin&amp;returnto=Towers+lasers+and+spacecrafts+example" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Sign in</a></li>	</ul>
</div>
				<div id="left-navigation">
					<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
	<h3 id="p-namespaces-label">Namespaces</h3>
	<ul>
					<li  id="ca-nstab-main" class="selected"><span><a href="http://wiki.qt.io/Towers_lasers_and_spacecrafts_example"  title="View the content page [c]" accesskey="c">Page</a></span></li>
					<li  id="ca-talk" class="new"><span><a href="http://wiki.qt.io/index.php?title=Talk:Towers_lasers_and_spacecrafts_example&amp;action=edit&amp;redlink=1"  title="Discussion about the content page [t]" accesskey="t">Discussion</a></span></li>
			</ul>
</div>
<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
	<h3 id="mw-vector-current-variant">
		</h3>
	<h3 id="p-variants-label"><span>Variants</span><a href="#"></a></h3>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>
				</div>
				<div id="right-navigation">
					<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
	<h3 id="p-views-label">Views</h3>
	<ul>
					<li id="ca-view" class="selected"><span><a href="http://wiki.qt.io/Towers_lasers_and_spacecrafts_example" >Read</a></span></li>
					<li id="ca-viewsource"><span><a href="http://wiki.qt.io/index.php?title=Towers_lasers_and_spacecrafts_example&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
					<li id="ca-history" class="collapsible"><span><a href="http://wiki.qt.io/index.php?title=Towers_lasers_and_spacecrafts_example&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
			</ul>
</div>
<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
	<h3 id="p-cactions-label"><span>Actions</span><a href="#"></a></h3>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>
<div id="p-search" role="search">
	<h3><label for="searchInput">Search</label></h3>
	<form action="http://wiki.qt.io/index.php" id="searchform">
					<div id="simpleSearch">
					<input type="search" name="search" placeholder="Search" title="Search Qt Wiki [f]" accesskey="f" id="searchInput" /><input type="hidden" value="Special:Search" name="title" /><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton" /><input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchButton" class="searchButton" />		</div>
	</form>
</div>
				</div>
			</div>
			<div id="mw-panel">
					<div id="p-logo" role="banner"><a style="background-image: url(http://wiki.qt.io/skins/common/images/wiki.png);" href="http://wiki.qt.io/Main_Page"  title="Visit the main page"></a></div>
				<div class="portal" role="navigation" id='p-navigation' aria-labelledby='p-navigation-label'>
	<h3 id='p-navigation-label'>Navigation</h3>
	<div class="body">
		<ul>
			<li id="n-mainpage-description"><a href="http://wiki.qt.io/Main_Page" title="Visit the main page [z]" accesskey="z">Main page</a></li>
			<li id="n-recentchanges"><a href="http://wiki.qt.io/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
			<li id="n-randompage"><a href="http://wiki.qt.io/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
			<li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>
		</ul>
	</div>
</div>
<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
	<h3 id='p-tb-label'>Tools</h3>
	<div class="body">
		<ul>
			<li id="t-whatlinkshere"><a href="http://wiki.qt.io/Special:WhatLinksHere/Towers_lasers_and_spacecrafts_example" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
			<li id="t-recentchangeslinked"><a href="http://wiki.qt.io/Special:RecentChangesLinked/Towers_lasers_and_spacecrafts_example" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
			<li id="t-specialpages"><a href="http://wiki.qt.io/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
			<li id="t-print"><a href="http://wiki.qt.io/index.php?title=Towers_lasers_and_spacecrafts_example&amp;oldid=17080&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
			<li id="t-permalink"><a href="http://wiki.qt.io/index.php?title=Towers_lasers_and_spacecrafts_example&amp;oldid=17080" title="Permanent link to this revision of the page">Permanent link</a></li>
			<li id="t-info"><a href="http://wiki.qt.io/index.php?title=Towers_lasers_and_spacecrafts_example&amp;action=info">Page information</a></li>
		</ul>
	</div>
</div>
			</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-info">
											<li id="footer-info-lastmod"> This page was last modified on 24 May 2015, at 12:34.</li>
											<li id="footer-info-viewcount">This page has been accessed 1,090 times.</li>
									</ul>
							<ul id="footer-places">
											<li id="footer-places-terms"><a href='https://developer.qtcloudservices.com/legal/terms'>Käyttöehdot</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
					<li id="footer-poweredbyico">
						<a href="http://www.mediawiki.org/"><img src="http://wiki.qt.io/skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" width="88" height="31" /></a>
					</li>
				</ul>
						<div style="clear:both"></div>
		</div>
		<script>/*<![CDATA[*/window.jQuery && jQuery.ready();/*]]>*/</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","skins.vector.collapsibleNav"],null,true);
}</script>
<script src="http://wiki.qt.io/load.php?debug=false&amp;lang=en&amp;modules=site&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','http://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54043535-2', 'auto');
  ga('send', 'pageview');

</script>
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":900});
}</script>
	</body>

<!-- Mirrored from wiki.qt.io/index.php?title=Towers_lasers_and_spacecrafts_example&oldid=17080 by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 05 Nov 2015 12:10:40 GMT -->
</html>
