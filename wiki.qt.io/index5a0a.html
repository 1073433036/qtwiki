<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">

<!-- Mirrored from wiki.qt.io/index.php?title=Iterators/bg&action=edit by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 05 Nov 2015 12:37:02 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8" />
<title>View source for Iterators/bg - Qt Wiki</title>
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />
<meta name="generator" content="MediaWiki 1.23.3" />
<meta name="robots" content="noindex,nofollow" />
<link rel="shortcut icon" href="http://wiki.qt.io/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="http://wiki.qt.io/opensearch_desc.php" title="Qt Wiki (en)" />
<link rel="EditURI" type="application/rsd+xml" href="http://wiki.qt.io/api.php?action=rsd" />
<link rel="alternate" type="application/atom+xml" title="Qt Wiki Atom feed" href="http://wiki.qt.io/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="http://wiki.qt.io/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.skinning.interface%7Cmediawiki.ui.button%7Cskins.vector.styles&amp;only=styles&amp;skin=vector&amp;*" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="http://wiki.qt.io/load.php?debug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=vector&amp;*" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: qtio_wiki:resourceloader:filter:minify-css:7:e91d7bc946738c8892a88ad5616a59ba */</style>
<script src="http://wiki.qt.io/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Iterators/bg","wgTitle":"Iterators/bg","wgCurRevisionId":15970,"wgRevisionId":0,"wgArticleId":2660,"wgIsArticle":false,"wgIsRedirect":false,"wgAction":"edit","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":true,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Iterators/bg","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"dialogs":true,"hidesig":true,"preview":true,"previewDialog":false,"publish":true}});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"editfont":"default","editondblclick":0,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":1,"extendwatchlist":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"imagesize":2,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nickname":"","norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"rcdays":7,"rclimit":50,"rows":25,"showhiddencats":0,"shownumberswatching":1,"showtoolbar":1,"skin":"vector","stubthreshold":0,"thumbsize":2,"underline":2,"uselivepreview":0,"usenewrc":0,"watchcreations":1,"watchdefault":1,"watchdeletion":0,"watchlistdays":3,"watchlisthideanons":0,"watchlisthidebots":0,"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"wllimit":250,
"useeditwarning":1,"prefershttps":1,"usebetatoolbar":1,"usebetatoolbar-cgd":1,"wikieditor-preview":1,"wikieditor-publish":1,"language":"en","variant-gan":"gan","variant-iu":"iu","variant-kk":"kk","variant-ku":"ku","variant-shi":"shi","variant-sr":"sr","variant-tg":"tg","variant-uz":"uz","variant-zh":"zh","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false,"searchNs500":false,"searchNs501":false,"searchNs700":false,"searchNs701":false,"variant":"en"});},{},{});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":false,"watchToken":false});},{},{});
/* cache key: qtio_wiki:resourceloader:filter:minify-js:7:9743cb8b8019d46de5946bfe6dfa04d7 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/vector/csshover.min.htc")}</style><![endif]--></head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Iterators_bg skin-vector action-edit vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>
			<div id="mw-js-message" style="display:none;"></div>
						<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">View source for Iterators/bg</span></h1>
						<div id="bodyContent">
								<div id="contentSub">← <a href="http://wiki.qt.io/Iterators/bg" title="Iterators/bg">Iterators/bg</a></div>
												<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="#mw-navigation">navigation</a>, 					<a href="#p-search">search</a>
				</div>
				<div id="mw-content-text"><p>You do not have permission to edit this page, for the following reason:
</p>
<div class="permissions-errors">
<p>The action you have requested is limited to users in one of the groups: <a href="http://wiki.qt.io/index.php?title=Qt_Wiki:Users&amp;action=edit&amp;redlink=1" class="new" title="Qt Wiki:Users (page does not exist)">Users</a>, KnowledgeBase, QtWS.
</p>
</div>
<hr />
<p>You can view and copy the source of this page:
</p><textarea readonly="" accesskey="," id="wpTextbox1" cols="80" rows="25" style="" lang="en" dir="ltr" name="wpTextbox1">{{Cleanup | reason=Auto-imported from ExpressionEngine.}}

'''Български''' [[QtIterators|English]]

[[Category:QtInternals]]


Написано от: Girish Ramakrishnan, ForwardBias Technologies

= Общ преглед =

Контейнерните класове в Qt ([http://doc.qt.io/qt-4.8/qvector.html QVector], [http://doc.qt.io/qt-4.8/qlist.html QList], [http://doc.qt.io/qt-4.8/qhash.html QHash] и т.н.) поддържат два вида итератори: В стил STL и в стил Java. Тази статия се задълбава в имплементацията на тези итератори. За въведение в контейнерните класове на Qt, прочетете [http://doc.qt.io/qt-4.8/containers.html документацията] за тях.

= Итератори в стил STL =

Итераторите в стил STL са страшно ефективни и бързи, защото те се държат общи линии като указатели. QVector&lt;T>::iterator е просто typedef на T * и е указател към елемент в масив, който QVector използва. Операторите '', - и т.н. са просто аритметика с указатели и използването на оператора * върху итератора е просто обръщение към стойността.

За контейнери като QList, итератора е указател към вътрешната за QList структура Node. Достатъчно е да кажем, че аритметичните операции и взимането на стойност са много бързи, тъй като те работят дъректно с данните.

Контейнерите в Qt са скрито споделени - когато копирате обект, само указател към данните се копира. Когато даден обект се модифицира, първо се създава ново кипие на данните, така че да не се засегнат другите мест, където той се използва. Процеса на създаването на копия на данните се нарича ''отделяне'' ( detach )

Тъй като, концептуално итераторите в стил STL са просто указатели, те модифицират данните директно. Като последствие от това, неконстантните итератори отделят данните, когато се създават, използвайки Container::begin(), така че другите споделени инстанции да де бъдат модифицирани. За да итерирате през контейнер, без да го модифицирате, трябва да използвате константни итератори.

Имплементацията на итератори в стил STL води до някои програмни грешки и клопки:
'''Първи проблем''':. Всяка операция, която променя структурата на вътрешните данни най-вероятно ще направи съществуващите итератори невалидни. На пример, QVector::append() може да накара QVector да създаде на ново вътрешният си масив и така всеки съществуващ вече итератор, ще стане не валиден указател. Дали итератор ще стане не валиден или не, зависи от контейнерния клас и имплементационните детайли. На пример, итератора на QMap остава валиден дори след премахване на елемент, стига да не е този, към който сочи. Същото важи и за QHash::erase(), която не прехешира, за разлика от QHash::remove(). Като цяло, правилото е да не използвате итератор след промяна на контейнера.

За пример:
&lt;code>
QVector&lt;int> vector1;
vector1 &lt;&lt; 1 &lt;&lt; 2 &lt;&lt; 3 &lt;&lt; 4;
QVector&lt;int>::const_iterator it = vector1.constBegin();
vector1 &lt;&lt; 5 &lt;&lt; 6 &lt;&lt; 7 &lt;&lt; 8; // променяме vector1
qDebug() &lt;&lt; *it; // опаа! невалиден указател
&lt;/code>

'''Втори проблем'''. Създаването на копие на контейнерен клас, когато има активен неконстантен итератор, може да има неочаквани странични ефекти.
&lt;code>
QVector&lt;int> vector1;
vector1 &lt;&lt; 1 &lt;&lt; 2 &lt;&lt; 3 &lt;&lt; 4;
QVector&lt;int>::iterator it = vector1.begin();
QVector&lt;int> vector2 = vector1; // vector2 вече споделя данни с vector1
*it = 10;
// не само vector1, но и vector2 също е модифициран!
&lt;/code>

Контйнерните класове в Qt са скрито споделени и следователно vector2 и vector1 споделят едни и същи данни. Итератора работи с тези данни директно (поради това, че итератора е просто указател). Това е противно на интуицията и природата на типовете, базирани на стойност, които гарантират, че стойностите никога не се променят зад гърба им.

= Итератори в стил Джава =
Основната цел на итераторите в стил Джава(освен стила на писане) е да решат проблемите на тези в стил STL. Вътрешно те използват STL итераторите. Така, че за целите на тази статия, е безопасно да предположим, че итераторите в стил Джава също съдържат указатели, но све пак успяват да предотвратят проблемите на STL-ските.

'''Решение на първия проблем'''. Константните (не-промянеруеми) итератори в стил Джава решават първия проблем като държат в себе си локално ''копие'' на контейнера. Вътрешно, те са имплементирани чрез използване на итератори в стил STL, създадени върху това ''копие''. Чрез поддържането на копие, за константният итератор в стил Джава е в безопасност от промени в оригиналния обект, тъй като Qt ще отдели данните, когато койнтейнера се модифицира. Това означава, че вие можете да продължите да обхождате дори след като оригиналния обект е станал невалиден. За да илюстрираме:
&lt;code>
QVector&lt;int> vector1;
vector1 &lt;&lt; 1 &lt;&lt; 2 &lt;&lt; 3 &lt;&lt; 4;
QVectorIterator&lt;int> it(vector1); // 'it' вече съдържа копие на vector1
vector1 &lt;&lt; 5 &lt;&lt; 6 &lt;&lt; 7 &lt;&lt; 8; // vector1 се отделя и локалното копие в QVectorIterator остава непокътнато
qDebug() &lt;&lt; it.value(); // безопасно, ще покаже 1
&lt;/code>

'''Решение на втория проблем'''. Неконстантните итератори в стил Джава решават втория проблем като правят контейнера ''несподелеруем''. Несподелеруемия контейнер е такъв, който не споделя данните си дори с нови обекти, които създават негово копие. За да илюстрираме:
&lt;code>
QVector v1;
v1 &lt;&lt; 1 &lt;&lt; 2 &lt;&lt; 2;
QVector v2 = v1; // v1 и v2 споделят едни и същи данни заради скритото споделяне
v1.setSharable(false); // маркираме v1 като несподелеруем (вътрешно API) и кара контейнера дасе отдели (т.е да си направи реално копие)
QVector v3 = v1; // v3 получава свое собствено копие на данните тъй като v1 е 'несподелеруем'
&lt;/code>

Благодарение на това, вторият проблем е избегнат - писането чрез използване на итератор на един обект не презаписва данните в някой друг обект.
&lt;code>
QVector&lt;int> vector1;
vector1 &lt;&lt; 1 &lt;&lt; 2 &lt;&lt; 3 &lt;&lt; 4;
QMutableVectorIterator it(vector1); // итератора държи указател към данните във vector1 и го прави несподелеруем
QVector&lt;int> vector2 = vector1; // тъй като vector1 е несподелеруем, vector2 получава свое собствено копие
it.setValue(10); // само vector1 се модифицира
&lt;/code>

= QT_STRICT_ITERATORS =
По подразбиране, понякога е възможно да се приравни неконстантен итератор на константен. Мислете за итератора като typedef на някакъв тип указател, C''+ позволява приравняването на неконстантни указатели към константни. За пример:
&lt;code>
QMap&lt;QString, QString> map;
QMap&lt;QString, QString>::const_iterator it = map.find("girish"); // кода се компилира и работи добре, но find() връща неконстантен QMap::iterator, който отделя данните!
&lt;/code>
</textarea><div class="templatesUsed"><div class="mw-templatesUsedExplanation"><p>Templates used on this page:
</p></div><ul>
<li><a href="http://wiki.qt.io/Template:Ambox" title="Template:Ambox">Template:Ambox</a> (<a href="http://wiki.qt.io/index.php?title=Template:Ambox&amp;action=edit" title="Template:Ambox">view source</a>) </li><li><a href="http://wiki.qt.io/Template:Cleanup" title="Template:Cleanup">Template:Cleanup</a> (<a href="http://wiki.qt.io/index.php?title=Template:Cleanup&amp;action=edit" title="Template:Cleanup">view source</a>) </li></ul></div><p id="mw-returnto">Return to <a href="http://wiki.qt.io/Iterators/bg" title="Iterators/bg">Iterators/bg</a>.</p>
</div>								<div class="printfooter">
				Retrieved from "<a href="http://wiki.qt.io/Iterators/bg">http://wiki.qt.io/Iterators/bg</a>"				</div>
												<div id='catlinks' class='catlinks catlinks-allhidden'></div>												<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>
			<div id="mw-head">
				<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
	<h3 id="p-personal-label">Personal tools</h3>
	<ul>
<li id="pt-anonuserpage"><a href="http://wiki.qt.io/User:10.0.113.70" class="new" title="The user page for the IP address you are editing as [.]" accesskey=".">10.0.113.70</a></li><li id="pt-anontalk"><a href="http://wiki.qt.io/User_talk:10.0.113.70" class="new" title="Discussion about edits from this IP address [n]" accesskey="n">Talk for this IP address</a></li><li id="pt-login"><a href="http://wiki.qt.io/index.php?title=Special:QtLogin&amp;returnto=Iterators%2Fbg" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Sign in</a></li>	</ul>
</div>
				<div id="left-navigation">
					<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
	<h3 id="p-namespaces-label">Namespaces</h3>
	<ul>
					<li  id="ca-nstab-main" class="selected"><span><a href="http://wiki.qt.io/Iterators/bg"  title="View the content page [c]" accesskey="c">Page</a></span></li>
					<li  id="ca-talk" class="new"><span><a href="http://wiki.qt.io/index.php?title=Talk:Iterators/bg&amp;action=edit&amp;redlink=1"  title="Discussion about the content page [t]" accesskey="t">Discussion</a></span></li>
			</ul>
</div>
<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
	<h3 id="mw-vector-current-variant">
		</h3>
	<h3 id="p-variants-label"><span>Variants</span><a href="#"></a></h3>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>
				</div>
				<div id="right-navigation">
					<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
	<h3 id="p-views-label">Views</h3>
	<ul>
					<li id="ca-view"><span><a href="http://wiki.qt.io/Iterators/bg" >Read</a></span></li>
					<li id="ca-viewsource" class="selected"><span><a href="http://wiki.qt.io/index.php?title=Iterators/bg&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
					<li id="ca-history" class="collapsible"><span><a href="http://wiki.qt.io/index.php?title=Iterators/bg&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
			</ul>
</div>
<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
	<h3 id="p-cactions-label"><span>Actions</span><a href="#"></a></h3>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>
<div id="p-search" role="search">
	<h3><label for="searchInput">Search</label></h3>
	<form action="http://wiki.qt.io/index.php" id="searchform">
					<div id="simpleSearch">
					<input type="search" name="search" placeholder="Search" title="Search Qt Wiki [f]" accesskey="f" id="searchInput" /><input type="hidden" value="Special:Search" name="title" /><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton" /><input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchButton" class="searchButton" />		</div>
	</form>
</div>
				</div>
			</div>
			<div id="mw-panel">
					<div id="p-logo" role="banner"><a style="background-image: url(http://wiki.qt.io/skins/common/images/wiki.png);" href="http://wiki.qt.io/Main_Page"  title="Visit the main page"></a></div>
				<div class="portal" role="navigation" id='p-navigation' aria-labelledby='p-navigation-label'>
	<h3 id='p-navigation-label'>Navigation</h3>
	<div class="body">
		<ul>
			<li id="n-mainpage-description"><a href="http://wiki.qt.io/Main_Page" title="Visit the main page [z]" accesskey="z">Main page</a></li>
			<li id="n-recentchanges"><a href="http://wiki.qt.io/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
			<li id="n-randompage"><a href="http://wiki.qt.io/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
			<li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>
		</ul>
	</div>
</div>
<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
	<h3 id='p-tb-label'>Tools</h3>
	<div class="body">
		<ul>
			<li id="t-whatlinkshere"><a href="http://wiki.qt.io/Special:WhatLinksHere/Iterators/bg" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
			<li id="t-recentchangeslinked"><a href="http://wiki.qt.io/Special:RecentChangesLinked/Iterators/bg" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
			<li id="t-specialpages"><a href="http://wiki.qt.io/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
			<li id="t-info"><a href="http://wiki.qt.io/index.php?title=Iterators/bg&amp;action=info">Page information</a></li>
		</ul>
	</div>
</div>
			</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-places">
											<li id="footer-places-terms"><a href='https://developer.qtcloudservices.com/legal/terms'>Käyttöehdot</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
					<li id="footer-poweredbyico">
						<a href="http://www.mediawiki.org/"><img src="http://wiki.qt.io/skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" width="88" height="31" /></a>
					</li>
				</ul>
						<div style="clear:both"></div>
		</div>
		<script>/*<![CDATA[*/window.jQuery && jQuery.ready();/*]]>*/</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.action.edit.collapsibleFooter","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","skins.vector.collapsibleNav"],null,true);
}</script>
<script src="http://wiki.qt.io/load.php?debug=false&amp;lang=en&amp;modules=site&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','http://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54043535-2', 'auto');
  ga('send', 'pageview');

</script>
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":317});
}</script>
	</body>

<!-- Mirrored from wiki.qt.io/index.php?title=Iterators/bg&action=edit by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 05 Nov 2015 12:37:02 GMT -->
</html>
