<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">

<!-- Mirrored from wiki.qt.io/index.php?title=CI_Machine_Configuration&action=edit by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 05 Nov 2015 13:03:16 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8" />
<title>View source for CI Machine Configuration - Qt Wiki</title>
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />
<meta name="generator" content="MediaWiki 1.23.3" />
<meta name="robots" content="noindex,nofollow" />
<link rel="shortcut icon" href="http://wiki.qt.io/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="http://wiki.qt.io/opensearch_desc.php" title="Qt Wiki (en)" />
<link rel="EditURI" type="application/rsd+xml" href="http://wiki.qt.io/api.php?action=rsd" />
<link rel="alternate" type="application/atom+xml" title="Qt Wiki Atom feed" href="http://wiki.qt.io/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="http://wiki.qt.io/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.skinning.interface%7Cmediawiki.ui.button%7Cskins.vector.styles&amp;only=styles&amp;skin=vector&amp;*" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="http://wiki.qt.io/load.php?debug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=vector&amp;*" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: qtio_wiki:resourceloader:filter:minify-css:7:e91d7bc946738c8892a88ad5616a59ba */</style>
<script src="http://wiki.qt.io/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"CI_Machine_Configuration","wgTitle":"CI Machine Configuration","wgCurRevisionId":18405,"wgRevisionId":0,"wgArticleId":607,"wgIsArticle":false,"wgIsRedirect":false,"wgAction":"edit","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":true,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"CI_Machine_Configuration","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"dialogs":true,"hidesig":true,"preview":true,"previewDialog":false,"publish":true}});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"editfont":"default","editondblclick":0,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":1,"extendwatchlist":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"imagesize":2,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nickname":"","norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"rcdays":7,"rclimit":50,"rows":25,"showhiddencats":0,"shownumberswatching":1,"showtoolbar":1,"skin":"vector","stubthreshold":0,"thumbsize":2,"underline":2,"uselivepreview":0,"usenewrc":0,"watchcreations":1,"watchdefault":1,"watchdeletion":0,"watchlistdays":3,"watchlisthideanons":0,"watchlisthidebots":0,"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"wllimit":250,
"useeditwarning":1,"prefershttps":1,"usebetatoolbar":1,"usebetatoolbar-cgd":1,"wikieditor-preview":1,"wikieditor-publish":1,"language":"en","variant-gan":"gan","variant-iu":"iu","variant-kk":"kk","variant-ku":"ku","variant-shi":"shi","variant-sr":"sr","variant-tg":"tg","variant-uz":"uz","variant-zh":"zh","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false,"searchNs500":false,"searchNs501":false,"searchNs700":false,"searchNs701":false,"variant":"en"});},{},{});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":false,"watchToken":false});},{},{});
/* cache key: qtio_wiki:resourceloader:filter:minify-js:7:9743cb8b8019d46de5946bfe6dfa04d7 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/vector/csshover.min.htc")}</style><![endif]--></head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-CI_Machine_Configuration skin-vector action-edit vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>
			<div id="mw-js-message" style="display:none;"></div>
						<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">View source for CI Machine Configuration</span></h1>
						<div id="bodyContent">
								<div id="contentSub">← <a href="http://wiki.qt.io/CI_Machine_Configuration" title="CI Machine Configuration">CI Machine Configuration</a></div>
												<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="#mw-navigation">navigation</a>, 					<a href="#p-search">search</a>
				</div>
				<div id="mw-content-text"><p>You do not have permission to edit this page, for the following reason:
</p>
<div class="permissions-errors">
<p>The action you have requested is limited to users in one of the groups: <a href="http://wiki.qt.io/index.php?title=Qt_Wiki:Users&amp;action=edit&amp;redlink=1" class="new" title="Qt Wiki:Users (page does not exist)">Users</a>, KnowledgeBase, QtWS.
</p>
</div>
<hr />
<p>You can view and copy the source of this page:
</p><textarea readonly="" accesskey="," id="wpTextbox1" cols="80" rows="25" style="" lang="en" dir="ltr" name="wpTextbox1">[[Category:Developing_Qt::QA]]
This page describes how the Qt Project CI machines (testers and servers) are set up and maintained.

== The qtqa/sysadmin repository ==

Most of the CI machine setup is maintained under source control, in the "qtqa/sysadmin" repository hosted in gerrit and on gitorious - http://qt.gitorious.org/qtqa/sysadmin

This repository holds metadata about the test machines and servers such as:

* the set of installed packages
* helper scripts deployed onto test machines
* configuration of tools used in the test process (perl, git, ssh, etc.)
* system-wide configuration for an unattended build/test machine running GUI tests (e.g. on Windows, registry values to disable the screensaver)
* other miscellaneous bits and pieces (e.g. the HTML and CSS templates used on http://testresults.qt.io/ )

The history of this repository dates to the beginning of 2011; prior to this, an internal repository was used within Nokia.

Most of the machines are controlled by a (free, open-source) sysadmin tool called [http://puppetlabs.com/ puppet] .

=== Introduction to puppet ===

The qtqa/sysadmin repository uses a masterless puppet setup (no central server).
In this configuration, puppet is run periodically (through a cron job or Windows scheduled task).
When run, it parses a set of files (''manifests'') which describe the desired state of the machine.
The qtqa/sysadmin repository itself is updated regularly on the machine, so that all changes are applied automatically.

For most tasks, puppet uses its own simple, mostly-declarative syntax. For more advanced tasks, it is possible to drop down to ruby.

Puppet code is typically arranged into '''modules''' of related code. For example, here is a snippet of code from the "qt_prereqs" module, intended to include the prerequisite packages for building and testing Qt:

&lt;code>
# from puppet/modules/qt_prereqs/manifests/linux.pp
# Linux-specific class inherits from a class applicable to all Unix-like systems
class qt_prereqs::linux inherits qt_prereqs::unix {

# These packages shall be installed on all Linux systems;
 # we could also say "ensure => absent" to make sure a package is ''not'' installed.
 # These come from the system's default package manager.
 package {
 "chrpath": ensure => installed;
 "lsb": ensure => installed;
 "libasound2-dev": ensure => installed;
 "libbluetooth-dev": ensure => installed;
 }

# enable some additional packages only on Ubuntu…
 if $::operatingsystem == "Ubuntu" {
 package {
 "libgstreamer-plugins-base0.10-dev": ensure => installed;
 "libdbus-1-dev": ensure => installed;
 "libssl-dev": ensure => installed;
 "libpulse-dev": ensure => installed;
 "pulseaudio": ensure => installed;
 }
 }

}
&lt;/code>

Each package declared above is referred to as a puppet '''resource'''. The most common types of resources used in our setup are:

* '''package''': ensures a particular package is installed, absent, or installed at a particular version
* '''file''': ensures a particular file or directory is present or absent, with specified permissions and content; the content may be generated from a ruby-based template (erb)
* '''exec''': run a command whenever puppet is run, if some condition evaluates to true (e.g. download and run some Windows installer to install some program, if it does not appear to be already installed)

The full reference of puppet's built-in resource types is documented online: http://docs.puppetlabs.com/references/2.7.19/type.html

The sysadmin repository also contains various custom defined types (e.g. a '''baselayout::startup''' type for managing commands executed when a user logs in).

=== Completeness of the puppet setup ===

Ideally, all aspects of test machines and servers would be encapsulated in puppet, so that the machine setup could always be reproduced in an automated and predictable manner. In practice, certain elements have proven difficult to automate with puppet, resulting in an incomplete puppet setup.

The level of completeness varies for each platform:

* '''Linux''': almost 100% complete. Linux is the most mature platform supported by puppet, and there are no known significant gaps in the setup.
* '''Mac''': mostly complete. Notably, on CI test machines, user account creation and the installation of xcode are not covered.
* '''Windows''': mostly incomplete. As a working puppet setup on Windows was not established until halfway through 2012, most machine setup completed prior to then is not covered, though this is being gradually improved.

=== Installing and configuring qtqa/sysadmin ===

'''Note:''' this section is currently '''proposed''' and depends on this change being merged - https://codereview.qt-project.org/33381

The recommended method for setting up a machine is to download and run the appropriate "bootstrap" script for your platform, found under the "bootstrap" folder ( http://qt.gitorious.org/qtqa/sysadmin/trees/master/bootstrap ).
These simple scripts are generally able to install the needed prerequisites (git, puppet) themselves. (On Windows, the situation is [http://wiki.qt.io/CI_Windows_Tester_Setup slightly more complicated].)

During the run of the bootstrap script, you'll be asked what kind of machine you are trying to configure (e.g. CI node, network test server, etc) and some additional questions about the setup.

The rest of this section describes the steps performed by the bootstrap scripts.

A machine maintained by the qtqa/sysadmin repository must declare its role (and possibly some parameters) in a simple configuration file under the puppet/nodecfg directory. An example of this configuration file:

&lt;code>
# YAML syntax.
# 'classes' declares which puppet classes should be included; in qtqa/sysadmin, there
# is one top-level class defined for each supported type of machine.
classes:
 # we want this machine to be a ci_tester (CI system build/test node)
 ci_tester:
 # we'll use the icecream distributed compilation tool…
 icecc_enabled: true
 # with this scheduler host…
 icecc_scheduler_host: "icecc.example.com"
 # …and all building/testing will be done under this user account
 testuser: qt
&lt;/code>

At least one class must be declared (and, in the usual case, only one class will be declared). Parameters can be left blank to use default values.

This configuration file can be interactively generated by running the '''puppet/nodecfg.pl -interactive''' command (which is also invoked as part of the previously mentioned bootstrap scripts). This tool will perform a simple question-answer process to generate the machine's configuration, such as in the following example:

pre.. $ puppet/nodecfg.pl -interactive
Configuring interactively.

This script will generate the following configuration file:

 puppet/nodecfg/10-config.yaml

The usage of this script is optional; it is intended to give a quick start
to configuring a machine for the most common use-cases.
It's fine to instead create the configuration by hand, or copy a file from
another machine, or skip this for now and come back later.

Press CTRL+C to abort this interactive process at any time.


Select which of the following best describes the purpose of this host:

 (1) network_test_server- Network test server, used for some QtNetwork autotests (qt-test-server.qt-test-net)
 (2) ci_server - Qt Project CI system server (Jenkins - Gerrit integration)
 (3) ci_tester - Qt Project CI tester, performing Qt compilation and autotests

? 3
Configuring a node of class 'ci_tester'

Username of the account used for all testing;
this should be an account which is not used for any other
activities on this machine.
 testuser [qt] ? test

Use icecream distributed compilation tool?
 icecc_enabled [y] ?

Icecream scheduler hostname; leave empty for autodiscovery,
 which usually works if the scheduler is on the same LAN and IP broadcast
 is working.
 icecc_scheduler_host [] ?

Configuration completed:

classes:
 ci_tester:
 icecc_enabled: true
 icecc_scheduler_host: ""
 testuser: test

Save (y/n) [y] ? y
Configuration saved to puppet/nodecfg/10-config.yaml.
To reconfigure, run: puppet/nodecfg.pl -interactive

After the configuration file is put in place, sync_and_run.pl should be run once (as root or administrator). This will set up the necessary cron job or scheduled task for managing the machine by qtqa/sysadmin from this point onwards. This is also done automatically by the bootstrap scripts.

== qtqa/sysadmin coding guidelines ==

The sysadmin repository generally follows the same rules as Qt itself, as well as a few additional guidelines.

* the repository is covered by the Qt Project CI system and commits must pass testing to be accepted.
* code should have a reasonable amount of autotest coverage (check the repo for examples of perl and puppet autotests)
* code must be reviewed in gerrit and receive a +2 score as per the rules for Qt itself.
</textarea><div class="templatesUsed"></div><p id="mw-returnto">Return to <a href="http://wiki.qt.io/CI_Machine_Configuration" title="CI Machine Configuration">CI Machine Configuration</a>.</p>
</div>								<div class="printfooter">
				Retrieved from "<a href="http://wiki.qt.io/CI_Machine_Configuration">http://wiki.qt.io/CI_Machine_Configuration</a>"				</div>
												<div id='catlinks' class='catlinks catlinks-allhidden'></div>												<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>
			<div id="mw-head">
				<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
	<h3 id="p-personal-label">Personal tools</h3>
	<ul>
<li id="pt-anonuserpage"><a href="http://wiki.qt.io/User:10.0.113.70" class="new" title="The user page for the IP address you are editing as [.]" accesskey=".">10.0.113.70</a></li><li id="pt-anontalk"><a href="http://wiki.qt.io/User_talk:10.0.113.70" class="new" title="Discussion about edits from this IP address [n]" accesskey="n">Talk for this IP address</a></li><li id="pt-login"><a href="http://wiki.qt.io/index.php?title=Special:QtLogin&amp;returnto=CI+Machine+Configuration" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Sign in</a></li>	</ul>
</div>
				<div id="left-navigation">
					<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
	<h3 id="p-namespaces-label">Namespaces</h3>
	<ul>
					<li  id="ca-nstab-main" class="selected"><span><a href="http://wiki.qt.io/CI_Machine_Configuration"  title="View the content page [c]" accesskey="c">Page</a></span></li>
					<li  id="ca-talk" class="new"><span><a href="http://wiki.qt.io/index.php?title=Talk:CI_Machine_Configuration&amp;action=edit&amp;redlink=1"  title="Discussion about the content page [t]" accesskey="t">Discussion</a></span></li>
			</ul>
</div>
<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
	<h3 id="mw-vector-current-variant">
		</h3>
	<h3 id="p-variants-label"><span>Variants</span><a href="#"></a></h3>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>
				</div>
				<div id="right-navigation">
					<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
	<h3 id="p-views-label">Views</h3>
	<ul>
					<li id="ca-view"><span><a href="http://wiki.qt.io/CI_Machine_Configuration" >Read</a></span></li>
					<li id="ca-viewsource" class="selected"><span><a href="http://wiki.qt.io/index.php?title=CI_Machine_Configuration&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
					<li id="ca-history" class="collapsible"><span><a href="http://wiki.qt.io/index.php?title=CI_Machine_Configuration&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
			</ul>
</div>
<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
	<h3 id="p-cactions-label"><span>Actions</span><a href="#"></a></h3>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>
<div id="p-search" role="search">
	<h3><label for="searchInput">Search</label></h3>
	<form action="http://wiki.qt.io/index.php" id="searchform">
					<div id="simpleSearch">
					<input type="search" name="search" placeholder="Search" title="Search Qt Wiki [f]" accesskey="f" id="searchInput" /><input type="hidden" value="Special:Search" name="title" /><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton" /><input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchButton" class="searchButton" />		</div>
	</form>
</div>
				</div>
			</div>
			<div id="mw-panel">
					<div id="p-logo" role="banner"><a style="background-image: url(http://wiki.qt.io/skins/common/images/wiki.png);" href="http://wiki.qt.io/Main_Page"  title="Visit the main page"></a></div>
				<div class="portal" role="navigation" id='p-navigation' aria-labelledby='p-navigation-label'>
	<h3 id='p-navigation-label'>Navigation</h3>
	<div class="body">
		<ul>
			<li id="n-mainpage-description"><a href="http://wiki.qt.io/Main_Page" title="Visit the main page [z]" accesskey="z">Main page</a></li>
			<li id="n-recentchanges"><a href="http://wiki.qt.io/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
			<li id="n-randompage"><a href="http://wiki.qt.io/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
			<li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>
		</ul>
	</div>
</div>
<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
	<h3 id='p-tb-label'>Tools</h3>
	<div class="body">
		<ul>
			<li id="t-whatlinkshere"><a href="http://wiki.qt.io/Special:WhatLinksHere/CI_Machine_Configuration" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
			<li id="t-recentchangeslinked"><a href="http://wiki.qt.io/Special:RecentChangesLinked/CI_Machine_Configuration" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
			<li id="t-specialpages"><a href="http://wiki.qt.io/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
			<li id="t-info"><a href="http://wiki.qt.io/index.php?title=CI_Machine_Configuration&amp;action=info">Page information</a></li>
		</ul>
	</div>
</div>
			</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-places">
											<li id="footer-places-terms"><a href='https://developer.qtcloudservices.com/legal/terms'>Käyttöehdot</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
					<li id="footer-poweredbyico">
						<a href="http://www.mediawiki.org/"><img src="http://wiki.qt.io/skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" width="88" height="31" /></a>
					</li>
				</ul>
						<div style="clear:both"></div>
		</div>
		<script>/*<![CDATA[*/window.jQuery && jQuery.ready();/*]]>*/</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.action.edit.collapsibleFooter","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","skins.vector.collapsibleNav"],null,true);
}</script>
<script src="http://wiki.qt.io/load.php?debug=false&amp;lang=en&amp;modules=site&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','http://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54043535-2', 'auto');
  ga('send', 'pageview');

</script>
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":449});
}</script>
	</body>

<!-- Mirrored from wiki.qt.io/index.php?title=CI_Machine_Configuration&action=edit by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 05 Nov 2015 13:03:16 GMT -->
</html>
